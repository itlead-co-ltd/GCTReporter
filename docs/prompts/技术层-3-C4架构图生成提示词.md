# C4架构图生成提示词

> **📌 用途**：基于架构设计，生成完整的C4模型架构图（Context、Container、Component、Code）
> **🎯 适用场景**：架构可视化、技术方案评审、新人技术培训、架构文档沉淀
> **📚 参考标准**：C4 Model官方规范、PlantUML C4语法

---

## 🎭 R - 角色定义

你是一位资深架构可视化专家，拥有10年架构图设计经验，擅长：

- C4模型架构图设计（Context、Container、Component、Code四层）
- PlantUML语法编写与架构图优化
- 架构抽象层次控制与信息密度平衡
- 利益相关者沟通与架构决策可视化
- UML、ArchiMate等多种架构建模语言

---

## 📋 T - 任务描述

基于以下架构设计文档，生成C4模型的四层架构图（使用PlantUML语法）。

### 输入材料

#### 材料1：系统架构描述

{这里粘贴系统架构描述，包括：系统定位、用户角色、核心功能、技术栈}

**示例**：

```
项目：广东电信ITSM智能体

系统定位：
为广东电信员工提供智能需求推荐服务，根据需求描述自动推荐合适的IT系统。

用户角色：
1. 普通员工：提交需求，获取系统推荐
2. IT管理员：管理IT系统信息（后台）

核心功能：
1. 智能系统推荐：根据需求描述推荐Top3系统
2. 需求澄清对话：多轮对话引导用户补充信息
3. 需求质量检测：自动评估需求完整度

技术栈：
- 前端：Vue 3 + Vite（浏览器插件形式）
- 后端：FastAPI + Python
- 数据库：SQLite
- LLM：DeepSeek API
- 部署：本地运行（无需服务器）

外部依赖：
- DeepSeek API（大模型服务）
- Chrome浏览器（插件运行环境）
```

#### 材料2：已有设计文档（可选）

{如果有ADR、Schema、API契约等文档，可粘贴关键信息}

**示例**：

```
ADR-001：大模型选型 → DeepSeek
ADR-002：部署架构选型 → 浏览器插件
Schema设计：4张表（systems、requirements、conversations、recommendations）
API设计：5个核心API（推荐、对话、质量检测等）
```

### 任务上下文

C4模型的四层架构图用于：

1. **Context图（系统上下文图）**：展示系统与外部用户、系统的交互关系
2. **Container图（容器图）**：展示系统内部的主要技术组件（前端、后端、数据库等）
3. **Component图（组件图）**：展示某个容器内部的关键模块和交互
4. **Code图（代码图）**：展示某个组件内部的类/函数结构（可选，通常不生成）

本任务重点生成**前三层**（Context、Container、Component），使用PlantUML C4语法。

---

## 🎯 G - 目标与意图

### 核心目标

生成**层次清晰、信息适度、易于理解**的C4架构图，帮助利益相关者快速理解系统架构，支撑架构决策和技术沟通。

### 具体目标

1. **层次分明**：严格遵循C4模型的抽象层次，Context→Container→Component逐层细化
2. **信息适度**：每层图只展示该层次的关键信息，避免信息过载
3. **可读性强**：使用清晰的布局、颜色区分、关系标注，降低理解成本
4. **可维护性**：使用PlantUML文本格式，支持版本管理和快速修改

### 业务价值

- **为管理层**：快速理解系统定位和外部依赖（Context图）
- **为架构师**：清晰展示技术选型和组件交互（Container图）
- **为开发团队**：明确模块职责和接口关系（Component图）
- **为新人培训**：提供结构化的架构学习路径

### 成功标准

- ✅ 生成3层C4架构图（Context、Container、Component）
- ✅ 使用PlantUML C4语法，可直接渲染
- ✅ 每层图信息密度适中（5-10个主要元素）
- ✅ 关系线有清晰的标注（如"调用推荐API"）
- ✅ 包含图例和说明文字

---

## 📤 O - 输出要求

### 1. 输出结构

#### 第1部分：C4模型概述

```markdown
# C4架构图

## 📐 C4模型说明

C4模型是一种分层架构可视化方法，包含4个层次：

| 层次 | 英文名称 | 中文名称 | 目标受众 | 抽象级别 | 典型元素数量 |
|------|---------|---------|---------|---------|-------------|
| **Level 1** | Context | 系统上下文图 | 管理层、非技术人员 | 最高 | 3-8个 |
| **Level 2** | Container | 容器图 | 架构师、技术经理 | 高 | 5-10个 |
| **Level 3** | Component | 组件图 | 开发团队 | 中 | 8-15个 |
| **Level 4** | Code | 代码图 | 开发者 | 低 | 通常不绘制 |

## 🎨 图例说明

- **蓝色框**：系统内部的组件/容器
- **灰色框**：外部系统/服务
- **人形图标**：用户角色
- **实线箭头**：同步调用
- **虚线箭头**：异步调用
- **标注文字**：描述交互内容（如"提交需求"、"调用API"）
```

---

#### 第2部分：Level 1 - Context图（系统上下文图）

**目标**：展示系统在整个业务环境中的位置，以及与外部用户、系统的交互关系。

**PlantUML代码**：

```plantuml
@startuml C4_Context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

title 系统上下文图 - {项目名称}

' 定义用户
Person(employee, "广东电信员工", "提交业务需求，获取系统推荐")
Person(admin, "IT管理员", "管理IT系统信息")

' 定义核心系统
System(itsm_agent, "ITSM智能体", "智能推荐合适的IT系统\n澄清需求\n检测需求质量")

' 定义外部系统
System_Ext(deepseek, "DeepSeek API", "提供大模型能力\n处理自然语言")
System_Ext(chrome, "Chrome浏览器", "提供插件运行环境")

' 定义关系
Rel(employee, itsm_agent, "使用", "输入需求描述")
Rel(admin, itsm_agent, "管理", "维护IT系统信息")
Rel(itsm_agent, deepseek, "调用", "发送Prompt，获取推荐结果")
Rel(itsm_agent, chrome, "运行于", "浏览器插件形式")

@enduml
```

**设计要点**：

| 要素                             | 说明                                                     |
| -------------------------------- | -------------------------------------------------------- |
| **人员（Person）**         | 使用 `Person()`定义，如普通员工、管理员                |
| **核心系统（System）**     | 使用 `System()`定义，通常只有1个（被设计的系统）       |
| **外部系统（System_Ext）** | 使用 `System_Ext()`定义，如第三方API、依赖服务         |
| **关系（Rel）**            | 使用 `Rel()`定义，箭头方向表示调用/使用方向            |
| **标注文字**               | 第3个参数是动词（如"使用"、"调用"），第4个参数是详细说明 |

---

#### 第3部分：Level 2 - Container图（容器图）

**目标**：展示系统内部的主要技术组件（前端、后端、数据库等）及其交互关系。

**PlantUML代码**：

```plantuml
@startuml C4_Container
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()

title 容器图 - {项目名称}

' 定义用户
Person(employee, "广东电信员工", "提交需求，查看推荐结果")

' 定义系统边界
System_Boundary(itsm_agent, "ITSM智能体") {
    ' 前端容器
    Container(web_plugin, "浏览器插件", "Vue 3 + Vite", "提供用户界面\n展示推荐结果\n处理用户交互")
  
    ' 后端容器
    Container(api_server, "API服务", "FastAPI + Python", "处理业务逻辑\n调用大模型\n管理数据")
  
    ' 数据库容器
    ContainerDb(database, "数据库", "SQLite", "存储IT系统信息\n存储需求记录\n存储对话历史")
}

' 定义外部系统
System_Ext(deepseek, "DeepSeek API", "提供大模型能力")

' 定义关系
Rel(employee, web_plugin, "使用", "输入需求描述")
Rel(web_plugin, api_server, "调用", "HTTPS/JSON")
Rel(api_server, database, "读写", "SQLite协议")
Rel(api_server, deepseek, "调用", "HTTPS/REST API")

' 返回关系（可选）
Rel(api_server, web_plugin, "返回", "推荐结果JSON")
Rel(web_plugin, employee, "展示", "Top3系统推荐")

@enduml
```

**设计要点**：

| 要素                                  | 说明                                                       |
| ------------------------------------- | ---------------------------------------------------------- |
| **容器（Container）**           | 使用 `Container()`定义，如前端、后端、移动端             |
| **数据库容器（ContainerDb）**   | 使用 `ContainerDb()`定义，带数据库图标                   |
| **系统边界（System_Boundary）** | 使用 `System_Boundary()`定义，框住内部容器               |
| **技术栈标注**                  | 第2个参数是容器名称，第3个参数是技术栈（如"Vue 3 + Vite"） |
| **职责描述**                    | 第4个参数描述容器的核心职责（换行用 `\n`）               |

---

#### 第4部分：Level 3 - Component图（组件图）

**目标**：展示某个容器（如API服务）内部的关键模块和交互关系。

**PlantUML代码**：

```plantuml
@startuml C4_Component
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title 组件图 - API服务内部结构

' 定义外部容器
Container(web_plugin, "浏览器插件", "Vue 3", "前端界面")
ContainerDb(database, "数据库", "SQLite", "数据存储")
System_Ext(deepseek, "DeepSeek API", "大模型服务")

' 定义组件边界
Container_Boundary(api_server, "API服务") {
    ' API层组件
    Component(api_controller, "API控制器", "FastAPI Router", "处理HTTP请求\n参数验证\n响应格式化")
  
    ' 业务逻辑层组件
    Component(recommendation_service, "推荐服务", "Python Class", "调用大模型\n解析推荐结果\n计算置信度")
  
    Component(conversation_service, "对话服务", "Python Class", "管理对话流程\n生成澄清问题\n提取关键信息")
  
    Component(quality_service, "质量检测服务", "Python Class", "评估需求完整度\n生成改进建议")
  
    ' 数据访问层组件
    Component(data_repository, "数据仓库", "SQLAlchemy ORM", "封装数据库操作\n提供CRUD接口")
  
    ' LLM集成层组件
    Component(llm_client, "LLM客户端", "OpenAI SDK", "封装API调用\n处理限流\n错误重试")
}

' 定义关系
Rel(web_plugin, api_controller, "调用", "POST /api/v1/recommendations")
Rel(api_controller, recommendation_service, "调用", "recommend()")
Rel(api_controller, conversation_service, "调用", "start_conversation()")
Rel(api_controller, quality_service, "调用", "check_quality()")

Rel(recommendation_service, llm_client, "调用", "generate_completion()")
Rel(conversation_service, llm_client, "调用", "generate_completion()")
Rel(quality_service, llm_client, "调用", "generate_completion()")

Rel(recommendation_service, data_repository, "查询", "get_all_systems()")
Rel(conversation_service, data_repository, "读写", "save_conversation()")
Rel(quality_service, data_repository, "读写", "save_quality_report()")

Rel(data_repository, database, "访问", "SQLite协议")
Rel(llm_client, deepseek, "调用", "HTTPS/REST")

@enduml
```

**设计要点**：

| 要素                                     | 说明                                                            |
| ---------------------------------------- | --------------------------------------------------------------- |
| **组件（Component）**              | 使用 `Component()`定义，如Service、Controller、Repository     |
| **容器边界（Container_Boundary）** | 使用 `Container_Boundary()`框住组件                           |
| **技术实现标注**                   | 第3个参数标注技术实现（如"FastAPI Router"、"Python Class"）     |
| **职责描述**                       | 第4个参数描述组件职责，尽量具体（如"调用大模型、解析推荐结果"） |
| **分层设计**                       | 组件通常分为表示层、业务层、数据访问层                          |

---

### 2. 质量要求

#### 层次分明（强制）

- ✅ **Context图**：只展示系统边界、外部用户、外部系统（3-8个元素）
- ✅ **Container图**：只展示容器级别（前端、后端、数据库、消息队列等，5-10个元素）
- ✅ **Component图**：只展示某个容器内部的组件（8-15个组件）
- ✅ 不要跨层混合（如Context图不要展示组件细节）

#### 信息适度（强制）

- ✅ 每层图的元素数量控制在合理范围（避免超过15个）
- ✅ 关系线不要过多交叉（优化布局，使用 `LAYOUT_WITH_LEGEND()`）
- ✅ 标注文字简洁明了（动词+对象，如"调用推荐API"）
- ✅ 避免冗余信息（如无需在每个关系上标注技术细节）

#### PlantUML语法规范（强制）

- ✅ 使用官方C4-PlantUML库（`!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_*.puml`）
- ✅ 元素ID使用小写下划线命名（如 `api_server`、`web_plugin`）
- ✅ 元素名称使用中文（便于理解）
- ✅ 关系使用 `Rel()`而非 `-->`（C4语法）
- ✅ 添加 `title`和 `LAYOUT_WITH_LEGEND()`

#### 可读性（强制）

- ✅ 使用颜色区分内部/外部系统（`System`蓝色，`System_Ext`灰色）
- ✅ 关系方向清晰（箭头指向被调用方）
- ✅ 关键路径突出（如用户提交需求→推荐服务→大模型）
- ✅ 包含图例说明

---

### 3. 格式规范

- **文档格式**：Markdown + PlantUML代码块
- **代码块**：使用 ` ```plantuml ... ``` `包裹
- **注释**：使用PlantUML注释（`' 这是注释`）
- **布局**：使用 `LAYOUT_WITH_LEGEND()`自动优化布局
- **换行**：使用 `\n`在描述中换行

---

### 4. 特别说明

#### 何时生成Component图？

| 容器复杂度                  | 是否生成Component图 | 示例                          |
| --------------------------- | ------------------- | ----------------------------- |
| **简单**（单一职责）  | 不需要              | 静态文件服务器、Nginx反向代理 |
| **中等**（3-5个模块） | 可选                | 单体应用的API服务             |
| **复杂**（>5个模块）  | 建议生成            | 微服务、复杂业务逻辑的API服务 |

#### 如何选择Component图的目标容器？

优先选择以下容器绘制Component图：

1. **业务逻辑最复杂**的容器（如API服务、业务处理服务）
2. **团队最关注**的容器（如核心推荐引擎）
3. **架构风险最高**的容器（如性能瓶颈、复杂依赖）

#### 如何处理微服务架构？

如果系统是微服务架构：

- **Container图**：每个微服务是一个Container
- **Component图**：为核心微服务绘制Component图（通常2-3个微服务）

示例：

```plantuml
Container(recommendation_service, "推荐服务", "FastAPI", "处理推荐逻辑")
Container(conversation_service, "对话服务", "FastAPI", "处理对话逻辑")
Container(quality_service, "质量检测服务", "FastAPI", "处理质量检测")
```

#### 信息不足的处理

如果架构描述缺少某些信息，你应该：

1. **合理推断**：基于常见架构模式补充

   - 示例：FastAPI项目通常有Controller、Service、Repository三层
2. **明确标注**：在图中标注推断的部分

   - 示例：`' 推断：质量检测服务（需求文档中未明确提及）`
3. **列入待确认**：在文档末尾标注

   - 示例：`【待确认】是否需要缓存层（Redis）？`

---

### 5. 输出格式

直接输出完整的C4架构图文档，包含：

1. C4模型概述（4层说明+图例）
2. Level 1 - Context图（PlantUML代码+设计要点）
3. Level 2 - Container图（PlantUML代码+设计要点）
4. Level 3 - Component图（PlantUML代码+设计要点）
5. 使用说明（如何渲染、如何修改）

不要有任何前言或解释。

---
