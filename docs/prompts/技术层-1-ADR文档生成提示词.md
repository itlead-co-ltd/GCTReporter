# ADR架构决策记录生成提示词

> **📌 用途**：基于技术选型需求，生成完整的ADR（Architecture Decision Record）文档  
> **🎯 适用场景**：技术选型决策、架构方案评估、技术栈迁移决策  
> **📚 参考标准**：[ADR规范](https://adr.github.io/)

---

## 🎭 R - 角色定义

你是一位资深软件架构师，拥有15年大型系统架构经验，擅长：

- 技术选型决策与风险评估
- 架构决策记录（ADR）编写
- 候选方案对比与权衡分析
- 容灾与回滚方案设计
- 分布式系统设计与微服务架构

---

## 📋 T - 任务描述

基于以下输入材料，生成一份完整的ADR（Architecture Decision Record）架构决策记录文档。

### 输入材料

#### 材料1：需求背景

{这里粘贴需求背景、PRD相关章节或User Story内容}

**示例**：
```
项目：广东电信ITSM智能体
需求：需要选择合适的大语言模型，实现智能系统推荐和需求澄清功能
技术约束：
- 预算有限（3天培训项目）
- 需要高准确率（>70%）
- 培训环境网络受限
```

#### 材料2：决策范围（可选）

{指定需要决策的技术层级}

**示例**：
```
决策层级：AI层 - 大语言模型选型
候选方案：DeepSeek、ChatGPT、Qwen本地部署
```

### 任务上下文

本ADR文档将用于：
1. 向技术委员会/评审团队说明技术选型理由
2. 记录决策过程，确保可追溯
3. 识别风险并制定应对措施
4. 为后续维护和演进提供决策依据

---

## 🎯 G - 目标与意图

### 核心目标

确保技术选型决策**可追溯、可回滚、可评审**，降低技术选型风险，为项目成功交付提供架构保障。

### 具体目标

1. **决策透明化**：记录技术选型的背景、理由、权衡分析，让团队和利益相关者理解决策逻辑
2. **风险可控化**：识别潜在风险并制定应对措施，包括回滚条件和备选方案
3. **知识沉淀化**：将架构决策转化为团队知识资产，避免重复决策和经验流失
4. **评审标准化**：提供明确的评审依据，支持技术委员会进行有效评审

### 业务价值

- **为架构师**：提供结构化决策框架，减少遗漏关键考量的风险
- **为项目经理**：提供风险评估依据，支持项目计划和资源分配决策
- **为技术团队**：明确技术方向和实施路径，减少理解偏差和返工成本
- **为管理层**：提供决策审批依据，评估技术投资的合理性和风险

### 成功标准

- ✅ ADR覆盖需求中所有技术约束和非功能需求
- ✅ 权衡分析包含至少3个备选方案及量化对比
- ✅ 回滚条件具体可判定，有明确的触发机制和执行计划
- ✅ 技术委员会评审通过（无P0级别问题）

---

## 📤 O - 输出要求

### 1. 输出结构（ADR文档8个章节）

#### 第1章：元信息

```markdown
# ADR-{编号}：{决策标题}

| 属性 | 内容 |
|------|------|
| **ADR编号** | ADR-001 |
| **状态** | 提议中/已接受/已废弃/已替代 |
| **决策日期** | YYYY-MM-DD |
| **决策人** | 架构组/技术委员会 |
| **关联需求** | Story #1 / PRD §3.2 |
| **替代ADR** | （如果状态为"已替代"，标注被哪个ADR替代） |
```

#### 第2章：背景（Context）

从需求材料中提取：
- **业务需求**：核心功能需求是什么
- **技术约束**：预算、时间、环境、网络等限制
- **当前痛点**：为什么需要做这个决策（现有方案的问题）

**格式要求**：
```markdown
## 背景

### 业务需求
{从需求材料提取}

### 技术约束
{从需求材料提取}

### 当前痛点
{说明为什么需要做这个技术决策}
```

#### 第3章：决策（Decision）

明确选择的方案：

```markdown
## 决策

**选择方案**：{方案名称}

**核心理由**（一句话概括）：
{为什么选择这个方案，一句话说明}

**示例**：
选择DeepSeek作为大语言模型，因为其性价比高、准确率满足需求且有官方文档支持。
```

#### 第4章：候选方案（Alternatives）

**要求**：至少对比3个候选方案

**格式**：使用表格对比

| 维度 | 方案A：{名称} | 方案B：{名称} | 方案C：{名称} |
|------|--------------|--------------|--------------|
| **成本** | {具体数字或估算} | {具体数字或估算} | {具体数字或估算} |
| **性能** | {量化指标} | {量化指标} | {量化指标} |
| **准确率** | {百分比} | {百分比} | {百分比} |
| **学习成本** | {高/中/低 + 说明} | {高/中/低 + 说明} | {高/中/低 + 说明} |
| **社区支持** | {活跃度评估} | {活跃度评估} | {活跃度评估} |
| **适配性** | {与项目需求匹配度} | {与项目需求匹配度} | {与项目需求匹配度} |

**示例**：
| 维度 | DeepSeek | ChatGPT-4 | Qwen本地部署 |
|------|----------|-----------|--------------|
| **成本** | 0.14元/百万Token | 7元/百万Token | 硬件成本5000元 |
| **准确率** | 85%（官方测评） | 90%（行业领先） | 75%（需微调） |
| **网络要求** | 需科学上网 | 需科学上网 | 无需联网 |
| **学习成本** | 低（有中文文档） | 中（英文文档为主） | 高（需GPU调优） |

#### 第5章：权衡分析（Rationale）

**格式**：每个方案列出优势✅和劣势❌

```markdown
## 权衡分析

### 方案A：{名称}

**✅ 优势**：
1. {优势1 + 量化说明}
2. {优势2 + 量化说明}
3. {优势3 + 量化说明}

**❌ 劣势**：
1. {劣势1 + 缓解措施}
2. {劣势2 + 缓解措施}

**缓解措施**：
- 针对劣势1：{具体缓解方法}
- 针对劣势2：{具体缓解方法}
```

**重要**：每个劣势必须配套缓解措施！

#### 第6章：后果（Consequences）

分为正面影响和负面影响：

```markdown
## 后果

### 正面影响
1. **{影响维度1}**：{具体说明}
2. **{影响维度2}**：{具体说明}
3. **{影响维度3}**：{具体说明}

### 负面影响与风险
| 风险 | 概率 | 影响 | 风险等级 | 应对措施 |
|------|------|------|---------|---------|
| {风险描述} | 高/中/低 | 高/中/低 | 🔴/🟡/🟢 | {具体应对措施} |

**示例**：
| 风险 | 概率 | 影响 | 风险等级 | 应对措施 |
|------|------|------|---------|---------|
| DeepSeek API不稳定 | 中 | 高 | 🔴 高 | 准备Qwen本地部署备选，1天内可切换 |
| 推荐准确率<70% | 中 | 高 | 🔴 高 | Prompt优化，增加示例样本训练 |
```

#### 第7章：回滚条件（Rollback Conditions）

**要求**：回滚条件必须具体可判定

```markdown
## 回滚条件

### 触发条件（满足任一条件即触发回滚）

1. **{条件1}**：{具体量化指标}
   - 监控方式：{如何监控}
   - 判定周期：{多久判定一次}
   - 责任人：{谁来判定}

**示例**：
1. **准确率不达标**：推荐Top3准确率连续3天<70%
   - 监控方式：每日统计推荐准确率（人工抽检50条）
   - 判定周期：每日9:00统计
   - 责任人：AI工程师

2. **成本超标**：月度API调用成本>预算30%
   - 监控方式：DeepSeek控制台账单监控
   - 判定周期：每周一检查
   - 责任人：项目经理

### 回滚方案

**备选方案**：{切换到哪个方案}

**执行步骤**：
1. {步骤1}（预计耗时：{时间}）
2. {步骤2}（预计耗时：{时间}）
3. {步骤3}（预计耗时：{时间}）

**总回滚时间**：{总计耗时}

**示例**：
**备选方案**：切换到Qwen本地部署

**执行步骤**：
1. 下载Qwen-7B模型（预计耗时：2小时）
2. 部署到本地GPU服务器（预计耗时：4小时）
3. 调整Prompt适配Qwen API（预计耗时：2小时）
4. 回归测试（预计耗时：4小时）

**总回滚时间**：1天（12小时）
```

#### 第8章：相关文档（References）

```markdown
## 相关文档

- **需求文档**：[Story #1](链接)
- **技术调研**：[DeepSeek技术评估报告](链接)
- **相关ADR**：[ADR-002 部署架构选型](链接)
- **待补充文档**：【待补充】成本预算表
```

---

### 2. 质量要求

#### 可追溯性（强制要求）

- 每个决策点必须标注来源
- 格式：`（来自需求 §3.2 性能标准）`或`（来自Story背景描述）`
- 如果是补充的需求，标注：`（基于{标准名称}补充）`

**示例**：
```markdown
### 技术约束
- 预算有限：3天培训项目，成本不超过500元（来自Story背景）
- 准确率要求：推荐Top3准确率≥70%（来自需求 §3.2 性能标准）
- 网络环境：培训环境可能无法科学上网（基于现场经验补充）
```

#### 量化表达（强制要求）

- 避免"性能好""很安全""成本低"等模糊表达
- 使用具体数字：准确率≥85%、成本0.14元/百万Token、延迟P95<2秒
- 所有成本必须估算（即使是粗略估算）

**❌ 错误示例**：
```
DeepSeek性价比高，适合本项目。
```

**✅ 正确示例**：
```
DeepSeek成本为0.14元/百万Token，预计3天培训消耗约10万Token，
总成本约1.4元，远低于ChatGPT的70元（7元/百万Token × 10万Token）。
```

#### 风险意识（强制要求）

- 权衡分析中的每个劣势，必须配套缓解措施
- 回滚条件必须具体可判定（不能是"效果不好"这种主观描述）
- 必须有备选方案和回滚时间估算

---

### 3. 格式规范

- **文档格式**：Markdown
- **表格**：用于结构化信息展示（候选方案对比、风险矩阵）
- **emoji**：增强可读性
  - ✅ 优势、通过
  - ❌ 劣势、不通过
  - ⚠️ 风险、待改进
  - 🔴 高风险
  - 🟡 中风险
  - 🟢 低风险
  - 📋 清单
  - 🔧 工具
- **代码块**：技术配置或命令行示例

---

### 4. 特别说明

#### 回滚条件设计原则（核心亮点）

**必须量化**（不能是"效果不理想"）

**❌ 错误示例**：
```
如果DeepSeek效果不好，切换到ChatGPT。
```

**✅ 正确示例**：
```
触发条件：推荐Top3准确率连续3天<70%
监控方式：每日人工抽检50条，统计准确率
判定周期：每日9:00统计
责任人：AI工程师
```

**必须有触发机制**（谁来监控？多久判定一次？）

**必须有备选方案**（回滚到哪里？）

**必须有执行计划**（具体步骤、预计时间）

---

#### 信息不足的处理方式

如果需求材料中缺少某些信息（如具体成本预算），你应该：

1. **合理推断**：基于行业经验给出估算
   - 示例：`DeepSeek成本约0.14元/百万Token（官方定价）`
   
2. **明确标注**：标注这是估算值
   - 示例：`预计3天培训消耗约10万Token（估算值，需实际监控确认）`
   
3. **列入待办**：在"相关文档"中标注
   - 示例：`【待补充】实际成本监控报告（Day3执行后补充）`

---

#### 候选方案数量

- **最少3个**：确保充分对比
- **推荐3-5个**：过多会导致分析过于复杂
- **如果只有2个**：必须说明为什么只有2个（如市场上只有2种成熟方案）

---

### 5. 输出格式

直接输出完整的ADR文档，不要有任何前言或解释。

文档开头格式：

```markdown
# ADR-{编号}：{决策标题}

| 属性 | 内容 |
|------|------|
| **ADR编号** | ADR-{编号} |
| **状态** | 提议中 |
| **决策日期** | {当前日期} |
| **决策人** | {决策人} |
| **关联需求** | {需求来源} |

---

## 背景

...
```

---

## ✨ 示例（参考Day2上午PPT纲要中的ADR-001）

**输入需求**：
```
项目：广东电信ITSM智能体
功能：智能系统推荐、需求澄清对话
技术约束：
- 预算有限（3天培训项目）
- 准确率≥70%
- 培训环境网络可能受限
```

**输出ADR文档**：
```markdown
# ADR-001：大语言模型选型

| 属性 | 内容 |
|------|------|
| **ADR编号** | ADR-001 |
| **状态** | 已接受 |
| **决策日期** | 2025-01-06 |
| **决策人** | 架构组 |
| **关联需求** | Story #1 智能系统推荐 |

---

## 背景

### 业务需求
需要实现智能系统推荐功能，根据用户输入的需求描述，推荐Top3系统。

### 技术约束
- 预算有限：3天培训项目，成本不超过500元
- 准确率要求：推荐Top3准确率≥70%
- 网络环境：培训环境可能无法科学上网

### 当前痛点
传统ITSM系统需要用户手动选择，用户不熟悉30个系统导致选错。

---

## 决策

**选择方案**：DeepSeek

**核心理由**：
DeepSeek性价比最高（0.14元/百万Token），准确率满足需求（85%），且有完善的中文文档支持。

---

## 候选方案

| 维度 | DeepSeek | ChatGPT-4 | Qwen本地部署 |
|------|----------|-----------|--------------|
| **成本** | 0.14元/百万Token | 7元/百万Token | 硬件成本5000元 |
| **准确率** | 85% | 90% | 75%（需微调） |
| **网络要求** | 需科学上网 | 需科学上网 | 无需联网 |
| **学习成本** | 低（中文文档） | 中（英文文档为主） | 高（需GPU调优） |

---

## 权衡分析

### DeepSeek

**✅ 优势**：
1. 性价比极高：0.14元/百万Token，预计3天成本仅1.4元
2. 准确率满足需求：85%（官方测评），高于70%要求
3. 学习成本低：有完善的中文文档和示例代码

**❌ 劣势**：
1. 需要科学上网：培训环境可能受限
2. 稳定性未知：新产品，可能有API不稳定情况

**缓解措施**：
- 针对网络问题：准备Qwen本地部署备选方案
- 针对稳定性：Day2提前测试，Day3可1天内切换到Qwen

---

（省略其他章节...）
```

---

## 📌 使用指南

### 步骤1：准备输入材料

复制需求文档相关章节到"输入材料1：需求背景"

### 步骤2：指定决策范围（可选）

如果需求明确，填写"输入材料2：决策范围"

### 步骤3：执行提示词

将整个提示词+输入材料提交给AI（Claude/ChatGPT/Copilot）

### 步骤4：检查输出质量

使用以下Checklist检查：

- [ ] ✅ 是否包含8个章节（元信息、背景、决策、候选方案、权衡分析、后果、回滚条件、相关文档）
- [ ] ✅ 候选方案是否≥3个
- [ ] ✅ 是否有量化对比（成本、性能等具体数字）
- [ ] ✅ 劣势是否有配套缓解措施
- [ ] ✅ 回滚条件是否具体可判定
- [ ] ✅ 是否有备选方案和回滚时间估算
- [ ] ✅ 信息来源是否标注可追溯

---

## 🔄 版本历史

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|---------|------|
| v1.0 | 2025-01-06 | 初始版本，基于RTGO框架 | AI架构师 |

---

**📌 注意事项**：

1. ADR是活文档，状态会随项目演进变化（提议中→已接受→已废弃/已替代）
2. 如果决策被推翻，创建新的ADR并标注"替代ADR-XXX"
3. 所有ADR纳入版本控制（Git），确保可追溯
4. 重大技术决策必须通过技术委员会评审后才能执行
