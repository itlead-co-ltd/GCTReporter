# 程序员报表生成工具 - 设计端任务拆解与估算（纵向拆解版）

> **📌 文档类型**：Sprint Backlog / 任务拆解文档
> **🎯 适用范围**：设计端（DESIGNER角色）用户故事
> **📅 生成日期**：2025-01-25
> **👥 目标团队**：2人团队（全栈开发能力）
> **⏱️ Sprint长度**：5个工作日
> **📐 拆解方式**：纵向拆解（按技术层次）

---

## 📊 输入材料概览

### 设计端用户故事清单（Must Have）

| Story ID | 故事标题 | 优先级 | Story Points | 估算工作量 |
|----------|---------|--------|--------------|------------|
| US000 | 开发环境搭建与项目初始化 | Must | 5 | 1天 |
| US010 | SQL编辑器实现（CodeMirror） | Must | 8 | 2天 |
| US011 | 报表基本信息配置 | Must | 3 | 0.5天 |
| US012 | 参数配置功能 | Must | 8 | 1.5天 |
| US013 | 列配置功能 | Must | 8 | 2天 |
| US014 | 报表创建功能 | Must | 5 | 1天 |
| US015 | 报表编辑功能 | Must | 3 | 0.5天 |
| US016 | 报表删除功能 | Must | 2 | 0.5天 |
| US017 | 报表预览（测试执行） | Must | 13 | 2.5天 |
| US018 | 为报表分配角色权限 | Must | 8 | 2天 |
63 Story Points / 13.5天工作量（含US000: 5 Story Points / 1天）
**总计**：58 Story Points / 12.5天工作量

### 团队信息

**团队成员**：
- **开发者A**（全栈）：每天6人时，精通Vue + SpringBoot
- **开发者B**（全栈）：每天6人时，精通Vue + SpringBoot

**Sprint长度**：5天

**团队可用产能**：2人 × 6人时/天 × 5天 = **60人时**

**经验因素**：
- ✅ 技术栈熟悉（Vue 3 + SpringBoot），无学习成本
- ⚠️ CodeMirror集成有风险，预留10%缓冲时间
- ⚠️ SQL执行引擎需要安全校验，预留5%缓冲时间
- 🎯 **产能利用率目标**：75%（45人时），留25%缓冲

---

## 🔍 第1部分：用户故事纵向拆解（按技术层次）

### US000：开发环境搭建与项目初始化（Story Points: 5）

#### 📱 前端任务

##### T00-1：前端项目初始化 ✅

**任务描述**：使用Vite创建Vue 3项目并初始化Git仓库

**验收标准**：
- [x] 使用`npm create vite@latest report-generator-web -- --template vue`创建项目成功
- [x] package.json文件存在且包含正确的项目名称（report-generator-web）
- [x] 项目可以使用`npm install`安装依赖（94个包已安装）
- [ ] Git仓库初始化完成（.git目录存在）⚠️ 待手动执行
- [x] .gitignore文件包含node_modules、dist、.DS_Store

**完成情况**：4/5项已完成（需手动执行git init）
**实际用时**：已完成创建和依赖安装
**依赖任务**：无
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-2：前端核心依赖安装

**任务描述**：安装Element Plus、CodeMirror、Axios、Vue Router、Pinia等核心依赖

**验收标准**：
- [ ] Element Plus 2.3.x安装成功
- [ ] vue-codemirror 4.0.6 + codemirror 5.65.x安装成功
- [ ] Axios 1.x安装成功
- [ ] Vue Router 4.x安装成功
- [ ] Pinia 2.x安装成功
- [ ] package.json的dependencies包含所有依赖

**依赖任务**：T00-1
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-3：前端目录结构创建

**任务描述**：创建标准的Vue项目目录结构（api、components、router、stores、utils、views）

**验收标准**：
- [ ] src/api目录创建完成
- [ ] src/components目录创建完成
- [ ] src/router目录创建完成（包含index.js路由配置）
- [ ] src/stores目录创建完成（包含index.js Pinia配置）
- [ ] src/utils目录创建完成
- [ ] src/views目录创建完成
- [ ] src/assets目录创建完成

**依赖任务**：T00-1
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-4：Vite配置

**任务描述**：配置Vite开发服务器（代理、路径别名、端口）

**验收标准**：
- [ ] vite.config.js包含路径别名配置（@指向src）
- [ ] 开发服务器端口配置为5173
- [ ] API代理配置完成（/api代理到http://localhost:8080）
- [ ] 代理配置包含changeOrigin: true
- [ ] 项目可以使用`npm run dev`正常启动

**依赖任务**：T00-2
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

#### 🔧 后端任务

##### T00-5：后端项目初始化

**任务描述**：使用Spring Initializr创建SpringBoot项目

**验收标准**：
- [ ] SpringBoot 3.1.x项目创建成功
- [ ] Group: com.itlead, Artifact: report-generator
- [ ] Java版本配置为17
- [ ] pom.xml文件存在且格式正确
- [ ] 项目可以使用`mvn clean compile`编译成功

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-6：后端核心依赖配置

**任务描述**：在pom.xml中添加Spring Web、JPA、MySQL、Lombok、Flyway、POI等依赖

**验收标准**：
- [ ] spring-boot-starter-web依赖添加成功
- [ ] spring-boot-starter-data-jpa依赖添加成功
- [ ] mysql-connector-java 8.0+依赖添加成功
- [ ] lombok依赖添加成功
- [ ] flyway-core 9.x依赖添加成功
- [ ] poi 5.x和poi-ooxml依赖添加成功
- [ ] `mvn dependency:resolve`执行成功

**依赖任务**：T00-5
**负责角色**：开发者B
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-7：后端目录结构创建

**任务描述**：创建标准的SpringBoot分层目录结构（controller、service、repository、entity、dto、util、config）

**验收标准**：
- [ ] com.itlead.reportgenerator.config包创建完成
- [ ] com.itlead.reportgenerator.controller包创建完成
- [ ] com.itlead.reportgenerator.service包创建完成
- [ ] com.itlead.reportgenerator.repository包创建完成
- [ ] com.itlead.reportgenerator.entity包创建完成
- [ ] com.itlead.reportgenerator.dto包创建完成
- [ ] com.itlead.reportgenerator.util包创建完成

**依赖任务**：T00-5
**负责角色**：开发者B
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-8：application.yml配置

**任务描述**：配置数据源、JPA、Flyway等核心配置

**验收标准**：
- [ ] 数据源配置完成（url、username、password）
- [ ] JPA配置完成（ddl-auto: validate, show-sql: true）
- [ ] Flyway配置完成（enabled: true, baseline-on-migrate: true）
- [ ] 服务端口配置为8080
- [ ] 时区配置为Asia/Shanghai

**依赖任务**：T00-6
**负责角色**：开发者B
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-9：Flyway数据库脚本

**任务描述**：创建V1表结构脚本和V2初始数据脚本

**验收标准**：
- [ ] src/main/resources/db/migration/V1__init_schema.sql创建完成
- [ ] V1脚本包含6张表（users、reports、report_params、report_columns、report_permissions、execution_logs）
- [ ] 所有表包含索引、外键、注释
- [ ] src/main/resources/db/migration/V2__init_data.sql创建完成
- [ ] V2脚本包含3个测试账号（admin、designer、viewer）
- [ ] 密码使用BCrypt加密格式

**依赖任务**：T00-8
**负责角色**：开发者B
**估算工时**：2h（乐观1.5h，最可能2h，悲观3h）

---

#### 🧪 测试任务

##### T00-10：环境启动验证测试

**任务描述**：验证前后端项目可以正常启动

**验收标准**：
- [ ] 前端项目使用`npm run dev`启动成功，访问http://localhost:5173正常
- [ ] 后端项目使用`mvn spring-boot:run`启动成功
- [ ] 后端访问http://localhost:8080返回JSON响应
- [ ] 前端可以通过代理访问后端（测试API调用）
- [ ] 控制台无错误日志

**依赖任务**：T00-4, T00-9
**负责角色**：开发者A和B
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T00-11：数据库初始化验证

**任务描述**：验证Flyway脚本执行成功，数据库表和数据正确创建

**验收标准**：
- [ ] MySQL数据库report_generator存在
- [ ] 6张表全部创建成功（users、reports、report_params、report_columns、report_permissions、execution_logs）
- [ ] flyway_schema_history表存在且包含2条记录（V1、V2）
- [ ] users表包含3条测试账号记录
- [ ] 可以使用admin/admin123登录（密码验证通过）

**依赖任务**：T00-9
**负责角色**：开发者B
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

### US010：SQL编辑器实现（CodeMirror）（Story Points: 8）

#### 📱 前端任务

##### T10-1：CodeMirror集成

**任务描述**：安装并配置vue-codemirror 4.0.6 + CodeMirror 5.65.x

**验收标准**：
- [ ] CodeMirror 5.65.x安装成功
- [ ] vue-codemirror 4.0.6封装组件创建完成
- [ ] 编辑器在页面中正常显示
- [ ] 编辑器可以输入和编辑文本
- [ ] 行号正常显示

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：2h（乐观1h，最可能2h，悲观3h）

---

##### T10-2：SQL语法高亮配置

**任务描述**：配置text/x-mysql模式，实现SQL关键字语法高亮

**验收标准**：
- [ ] text/x-mysql模式加载成功
- [ ] SELECT、FROM、WHERE等关键字高亮显示
- [ ] 表名、字段名正常显示（不高亮）
- [ ] 字符串和数字有不同颜色区分
- [ ] 注释（-- 和 /* */）正确高亮

**依赖任务**：T10-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T10-3：快捷键绑定

**任务描述**：实现Ctrl+S保存、Ctrl+Enter执行快捷键

**验收标准**：
- [ ] Ctrl+S触发保存草稿功能
- [ ] Ctrl+Enter触发SQL测试执行
- [ ] 快捷键响应无延迟
- [ ] 快捷键不与浏览器默认行为冲突
- [ ] 快捷键提示在界面上显示

**依赖任务**：T10-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T10-4：草稿自动保存

**任务描述**：实现30秒自动保存草稿到localStorage

**验收标准**：
- [ ] 30秒定时器正常工作
- [ ] 草稿数据保存到localStorage
- [ ] 页面刷新后草稿自动加载
- [ ] 手动保存按钮可立即保存
- [ ] 保存成功有Toast提示

**依赖任务**：T10-1
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🔧 后端任务

##### T10-5：草稿保存API

**任务描述**：实现POST /api/v1/report-drafts接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/report-drafts
- [ ] 接收报表草稿数据（JSON格式）
- [ ] 数据保存到数据库draft表
- [ ] 返回草稿ID和保存时间
- [ ] 异常情况返回错误信息

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T10-6：草稿加载API

**任务描述**：实现GET /api/v1/report-drafts/{id}接口

**验收标准**：
- [ ] 接口路径为GET /api/v1/report-drafts/{id}
- [ ] 根据草稿ID查询数据库
- [ ] 返回完整的草稿数据（JSON格式）
- [ ] 草稿不存在返回404错误
- [ ] 权限校验（只能查看自己的草稿）

**依赖任务**：T10-5
**负责角色**：开发者B
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

#### 🧪 测试任务

##### T10-7：前端组件测试

**任务描述**：测试CodeMirror组件的前端功能

**验收标准**：
- [ ] 编辑器渲染测试通过
- [ ] 语法高亮测试通过
- [ ] 快捷键响应测试通过
- [ ] 自动保存测试通过
- [ ] 测试覆盖率≥80%

**依赖任务**：T10-4
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T10-8：API集成测试

**任务描述**：测试草稿保存和加载API

**验收标准**：
- [ ] 草稿保存接口测试通过
- [ ] 草稿加载接口测试通过
- [ ] 权限校验测试通过
- [ ] 异常情况测试通过
- [ ] 测试用例全部通过

**依赖任务**：T10-6
**负责角色**：开发者B
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

### US011：报表基本信息配置（Story Points: 3）

#### 📱 前端任务

##### T11-1：基本信息表单

**任务描述**：创建报表名称和描述输入表单

**验收标准**：
- [ ] 表单包含名称输入框（限制50字符）
- [ ] 表单包含描述多行文本框（Textarea）
- [ ] 表单样式符合设计规范
- [ ] 字符计数器显示正常
- [ ] 表单响应式布局正常

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T11-2：表单校验

**任务描述**：实现必填和唯一性校验

**验收标准**：
- [ ] 名称为空时显示错误提示
- [ ] 名称重复时调用后端API校验
- [ ] 校验错误时表单不能提交
- [ ] 错误提示文案友好清晰
- [ ] 校验通过后可正常提交

**依赖任务**：T11-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

#### 🔧 后端任务

##### T11-3：报表名称唯一性校验API

**任务描述**：实现GET /api/v1/reports/check-name接口

**验收标准**：
- [ ] 接口路径为GET /api/v1/reports/check-name?name=xxx
- [ ] 查询数据库判断名称是否存在
- [ ] 返回JSON：{exists: true/false}
- [ ] 响应时间<100ms
- [ ] 大小写敏感校验

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

#### 🧪 测试任务

##### T11-4：表单校验测试

**任务描述**：测试表单必填和唯一性校验

**验收标准**：
- [ ] 必填校验测试通过
- [ ] 唯一性校验测试通过
- [ ] 错误提示显示测试通过
- [ ] API调用测试通过
- [ ] 边界情况测试通过

**依赖任务**：T11-3
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

### US012：参数配置功能（Story Points: 8）

#### 📱 前端任务

##### T12-1：参数配置表格UI

**任务描述**：创建可编辑参数配置表格

**验收标准**：
- [ ] 表格包含参数名、类型、默认值、必填、说明、排序列
- [ ] 表格支持内联编辑
- [ ] 添加参数按钮正常工作
- [ ] 表格样式符合设计规范
- [ ] 空状态提示显示正常

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：2h（乐观1.5h，最可能2h，悲观3h）

---

##### T12-2：参数类型切换

**任务描述**：实现参数类型下拉选择（STRING/NUMBER/DATE/DATETIME）

**验收标准**：
- [ ] 下拉框包含4种参数类型
- [ ] 类型切换时默认值输入框相应变化
- [ ] STRING类型显示文本框
- [ ] NUMBER类型显示数字框
- [ ] DATE/DATETIME类型显示日期选择器

**依赖任务**：T12-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T12-3：参数增删改排序

**任务描述**：实现参数的添加、删除、上移、下移功能

**验收标准**：
- [ ] 添加参数按钮新增空行
- [ ] 删除按钮删除当前行（带确认）
- [ ] 上移按钮将参数上移一位
- [ ] 下移按钮将参数下移一位
- [ ] 排序后sortOrder自动更新

**依赖任务**：T12-1
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T12-4：SQL占位符提取与匹配校验

**任务描述**：从SQL中提取:paramName占位符并与参数配置匹配

**验收标准**：
- [ ] 正则表达式提取SQL中所有:paramName
- [ ] 提取的参数显示在参数列表上方
- [ ] 校验SQL参数与配置参数是否一致
- [ ] 不匹配时显示警告提示
- [ ] 自动添加缺失的参数到配置

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🔧 后端任务

##### T12-5：参数配置保存API

**任务描述**：实现POST /api/v1/reports/{id}/params接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/reports/{id}/params
- [ ] 接收参数配置数组（JSON）
- [ ] 批量保存参数到report_params表
- [ ] 更新报表updated_at字段
- [ ] 返回保存成功的参数列表

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T12-6：SQL参数提取工具类

**任务描述**：实现Java工具类提取SQL中的参数占位符

**验收标准**：
- [ ] 正则表达式提取:paramName
- [ ] 返回参数名列表（去重）
- [ ] 处理SQL注释中的占位符（忽略）
- [ ] 单元测试覆盖率≥90%
- [ ] 工具类可复用

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🧪 测试任务

##### T12-7：参数配置功能测试

**任务描述**：测试参数配置的增删改查和匹配校验

**验收标准**：
- [ ] 参数添加测试通过
- [ ] 参数删除测试通过
- [ ] 参数排序测试通过
- [ ] 参数类型切换测试通过
- [ ] SQL参数匹配校验测试通过

**依赖任务**：T12-5
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

### US013：列配置功能（Story Points: 8）

#### 📱 前端任务

##### T13-1：列配置表格UI

**任务描述**：创建可编辑列配置表格

**验收标准**：
- [ ] 表格包含字段名、显示名称、列宽、格式化类型、显示/隐藏、排序列
- [ ] 表格支持内联编辑
- [ ] Switch开关控制显示/隐藏
- [ ] 表格样式符合设计规范
- [ ] 空状态提示显示正常

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：2h（乐观1.5h，最可能2h，悲观3h）

---

##### T13-2：列属性配置

**任务描述**：实现列的显示名称、列宽、格式化类型配置

**验收标准**：
- [ ] 显示名称输入框可编辑
- [ ] 列宽输入框限制50-500px
- [ ] 格式化类型下拉框包含DEFAULT/DATE/NUMBER/CURRENCY
- [ ] 配置变更实时保存
- [ ] 输入校验生效

**依赖任务**：T13-1
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T13-3：列显示/隐藏控制

**任务描述**：实现列的显示/隐藏Switch开关

**验收标准**：
- [ ] Switch开关切换正常
- [ ] 隐藏的列在表格中不显示
- [ ] 全部显示按钮批量显示所有列
- [ ] 全部隐藏按钮批量隐藏所有列
- [ ] 至少保留一列可见（校验）

**依赖任务**：T13-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T13-4：列排序功能

**任务描述**：实现列的上移、下移排序

**验收标准**：
- [ ] 上移按钮将列上移一位
- [ ] 下移按钮将列下移一位
- [ ] 第一列上移按钮禁用
- [ ] 最后一列下移按钮禁用
- [ ] 排序后sortOrder自动更新

**依赖任务**：T13-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

#### 🔧 后端任务

##### T13-5：ResultSetMetaData列提取

**任务描述**：从ResultSet中提取列信息（列名、类型）

**验收标准**：
- [ ] 执行SQL查询获取ResultSet
- [ ] 使用ResultSetMetaData提取列信息
- [ ] 提取列名（columnName）
- [ ] 提取列类型（columnType，JDBC类型）
- [ ] 映射JDBC类型到前端格式化类型

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：3h（乐观2h，最可能3h，悲观4h）

---

##### T13-6：自动提取列API

**任务描述**：实现POST /api/v1/reports/extract-columns接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/reports/extract-columns
- [ ] 接收SQL和参数（用于执行）
- [ ] 调用T13-5提取列信息
- [ ] 返回列信息数组（JSON）
- [ ] 异常情况返回错误信息

**依赖任务**：T13-5
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T13-7：列配置保存API

**任务描述**：实现POST /api/v1/reports/{id}/columns接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/reports/{id}/columns
- [ ] 接收列配置数组（JSON）
- [ ] 批量保存列配置到report_columns表
- [ ] 更新报表updated_at字段
- [ ] 返回保存成功的列配置列表

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🧪 测试任务

##### T13-8：列配置功能测试

**任务描述**：测试列配置的自动提取和手动配置

**验收标准**：
- [ ] 自动提取列测试通过
- [ ] 列属性配置测试通过
- [ ] 列显示/隐藏测试通过
- [ ] 列排序测试通过
- [ ] 列配置保存测试通过

**依赖任务**：T13-7
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

### US014：报表创建功能（Story Points: 5）

#### 📱 前端任务

##### T14-1：多步骤表单整合

**任务描述**：整合Step1-4页面路由和步骤导航

**验收标准**：
- [ ] 4个步骤页面路由配置完成
- [ ] 步骤条显示当前步骤
- [ ] 上一步/下一步按钮导航正常
- [ ] 步骤切换有过渡动画
- [ ] 步骤数据在页面间共享

**依赖任务**：T10-8, T11-4, T12-7, T13-8
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T14-2：表单数据收集与提交

**任务描述**：收集Step1-4所有配置数据并提交

**验收标准**：
- [ ] 收集报表基本信息
- [ ] 收集SQL内容
- [ ] 收集参数配置数组
- [ ] 收集列配置数组
- [ ] 组装完整JSON数据结构

**依赖任务**：T14-1
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T14-3：保存成功跳转

**任务描述**：保存成功后跳转到报表列表

**验收标准**：
- [ ] 保存成功显示Toast提示
- [ ] 1.5秒后自动跳转到列表页
- [ ] 跳转后清除草稿数据
- [ ] 列表页高亮显示新建报表
- [ ] 跳转动画平滑

**依赖任务**：T14-2
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

#### 🔧 后端任务

##### T14-4：报表创建API

**任务描述**：实现POST /api/v1/reports接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/reports
- [ ] 接收完整报表配置（JSON）
- [ ] 保存报表基本信息到reports表
- [ ] 调用事务处理保存参数和列
- [ ] 返回报表ID和创建时间

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：3h（乐观2h，最可能3h，悲观4h）

---

##### T14-5：事务处理

**任务描述**：实现报表+参数+列配置的事务一致性保存

**验收标准**：
- [ ] 使用@Transactional注解
- [ ] 报表保存失败时回滚
- [ ] 参数保存失败时回滚
- [ ] 列配置保存失败时回滚
- [ ] 事务隔离级别正确配置

**依赖任务**：T14-4
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🧪 测试任务

##### T14-6：报表创建E2E测试

**任务描述**：端到端测试完整的报表创建流程

**验收标准**：
- [ ] Step1基本信息填写测试通过
- [ ] Step2 SQL编辑测试通过
- [ ] Step3参数配置测试通过
- [ ] Step4列配置测试通过
- [ ] 完整流程保存测试通过

**依赖任务**：T14-5
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

### US015：报表编辑功能（Story Points: 3）

#### 📱 前端任务

##### T15-1：报表配置加载

**任务描述**：加载报表的基本信息、SQL、参数、列配置

**验收标准**：
- [ ] 调用后端API获取完整配置
- [ ] 加载报表基本信息
- [ ] 加载SQL内容
- [ ] 加载参数配置数组
- [ ] 加载列配置数组

**依赖任务**：T14-6
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T15-2：表单预填充

**任务描述**：将加载的配置预填充到Step1-4表单

**验收标准**：
- [ ] Step1基本信息预填充
- [ ] Step2 SQL编辑器预填充
- [ ] Step3参数表格预填充
- [ ] Step4列配置表格预填充
- [ ] 预填充数据格式正确

**依赖任务**：T15-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T15-3：更新提交

**任务描述**：提交修改后的报表配置

**验收标准**：
- [ ] 调用PUT /api/v1/reports/{id}接口
- [ ] 提交更新后的完整配置
- [ ] 更新成功显示Toast提示
- [ ] 更新成功后跳转到列表页
- [ ] 更新失败显示错误信息

**依赖任务**：T15-2
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

#### 🔧 后端任务

##### T15-4：报表配置查询API

**任务描述**：实现GET /api/v1/reports/{id}/full接口

**验收标准**：
- [ ] 接口路径为GET /api/v1/reports/{id}/full
- [ ] 查询报表基本信息
- [ ] 关联查询参数配置
- [ ] 关联查询列配置
- [ ] 返回完整JSON数据

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T15-5：报表更新API

**任务描述**：实现PUT /api/v1/reports/{id}接口

**验收标准**：
- [ ] 接口路径为PUT /api/v1/reports/{id}
- [ ] 更新报表基本信息
- [ ] 更新参数配置（先删除再插入）
- [ ] 更新列配置（先删除再插入）
- [ ] 使用事务保证一致性

**依赖任务**：T15-4
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🧪 测试任务

##### T15-6：报表编辑功能测试

**任务描述**：测试报表编辑的加载、修改、保存流程

**验收标准**：
- [ ] 配置加载测试通过
- [ ] 表单预填充测试通过
- [ ] 配置修改测试通过
- [ ] 配置更新测试通过
- [ ] E2E测试通过

**依赖任务**：T15-5
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

### US016：报表删除功能（Story Points: 2）

#### 📱 前端任务

##### T16-1：删除确认对话框

**任务描述**：创建删除确认对话框

**验收标准**：
- [ ] 对话框显示报表名称
- [ ] 对话框显示警告信息
- [ ] 确认按钮为红色（危险色）
- [ ] 取消按钮正常工作
- [ ] 对话框关闭动画平滑

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T16-2：删除API调用

**任务描述**：调用DELETE /api/v1/reports/{id}接口

**验收标准**：
- [ ] 确认后调用删除接口
- [ ] 删除成功显示Toast提示
- [ ] 删除成功后刷新列表
- [ ] 删除失败显示错误信息
- [ ] 加载状态显示正常

**依赖任务**：T16-1
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

#### 🔧 后端任务

##### T16-3：报表删除API

**任务描述**：实现DELETE /api/v1/reports/{id}接口（级联删除）

**验收标准**：
- [ ] 接口路径为DELETE /api/v1/reports/{id}
- [ ] 删除报表基本信息
- [ ] 级联删除参数配置
- [ ] 级联删除列配置
- [ ] 级联删除权限配置

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🧪 测试任务

##### T16-4：报表删除功能测试

**任务描述**：测试报表删除和级联删除

**验收标准**：
- [ ] 删除确认对话框测试通过
- [ ] 删除API调用测试通过
- [ ] 级联删除测试通过
- [ ] 权限校验测试通过
- [ ] E2E测试通过

**依赖任务**：T16-3
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

### US017：报表预览（测试执行）（Story Points: 13）

#### 📱 前端任务

##### T17-1：参数输入对话框（动态生成）

**任务描述**：根据参数配置动态生成参数输入表单

**验收标准**：
- [ ] 根据参数类型生成对应控件（文本框/数字框/日期选择器）
- [ ] 必填参数标红星
- [ ] 参数说明显示在输入框下方
- [ ] 参数默认值自动填充
- [ ] 参数校验生效

**依赖任务**：T12-7
**负责角色**：开发者A
**估算工时**：3h（乐观2h，最可能3h，悲观4h）

---

##### T17-2：测试执行按钮

**任务描述**：创建测试执行按钮并触发执行

**验收标准**：
- [ ] 测试执行按钮显示正常
- [ ] 点击后弹出参数输入对话框
- [ ] 参数填写完成后调用后端API
- [ ] 执行中显示加载动画
- [ ] 按钮状态管理正确

**依赖任务**：T17-1
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

##### T17-3：执行结果表格展示

**任务描述**：展示SQL执行结果（前100行）

**验收标准**：
- [ ] 使用Element UI Table展示数据
- [ ] 表格自动生成列（根据返回的JSON）
- [ ] 表格支持横向滚动
- [ ] 表头固定（滚动时不消失）
- [ ] 空结果显示友好提示

**依赖任务**：T17-2
**负责角色**：开发者A
**估算工时**：2h（乐观1.5h，最可能2h，悲观3h）

---

##### T17-4：执行信息显示

**任务描述**：显示执行耗时和结果行数

**验收标准**：
- [ ] 显示执行耗时（毫秒）
- [ ] 显示结果行数
- [ ] 显示"前100行"提示（如果超过100行）
- [ ] 信息显示位置合理
- [ ] 样式符合设计规范

**依赖任务**：T17-3
**负责角色**：开发者A
**估算工时**：0.5h（乐观0.5h，最可能0.5h，悲观1h）

---

#### 🔧 后端任务

##### T17-5：SQL安全校验

**任务描述**：实现SQL白名单和黑名单校验

**验收标准**：
- [ ] 白名单：仅允许SELECT语句
- [ ] 黑名单：禁止DROP、DELETE、TRUNCATE、UPDATE、INSERT、ALTER、CREATE、EXEC
- [ ] 使用正则表达式匹配关键字
- [ ] 危险SQL返回错误信息
- [ ] 校验结果可追溯

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：3h（乐观2h，最可能3h，悲观4h）

---

##### T17-6：PreparedStatement参数化执行

**任务描述**：使用PreparedStatement防止SQL注入

**验收标准**：
- [ ] 使用PreparedStatement执行SQL
- [ ] 参数占位符替换为?
- [ ] 参数值按顺序绑定
- [ ] SQL注入攻击测试通过
- [ ] 异常处理完善

**依赖任务**：T17-5
**负责角色**：开发者B
**估算工时**：2h（乐观1.5h，最可能2h，悲观3h）

---

##### T17-7：ResultSet转JSON

**任务描述**：将SQL查询结果转换为JSON格式

**验收标准**：
- [ ] 使用ResultSetMetaData获取列信息
- [ ] 遍历ResultSet提取数据
- [ ] 转换为JSON数组
- [ ] 处理NULL值（转为null）
- [ ] 日期类型格式化为ISO字符串

**依赖任务**：T17-6
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T17-8：查询超时控制

**任务描述**：实现5秒查询超时控制

**验收标准**：
- [ ] 设置Statement.setQueryTimeout(5)
- [ ] 超时后抛出SQLTimeoutException
- [ ] 超时异常返回友好错误信息
- [ ] 超时后释放数据库连接
- [ ] 超时测试通过

**依赖任务**：T17-6
**负责角色**：开发者B
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T17-9：SQL测试执行API

**任务描述**：实现POST /api/v1/reports/test-execute接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/reports/test-execute
- [ ] 接收SQL和参数（JSON）
- [ ] 调用SQL安全校验
- [ ] 调用PreparedStatement执行
- [ ] 返回前100行数据（JSON）

**依赖任务**：T17-8
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

#### 🧪 测试任务

##### T17-10：SQL安全校验测试

**任务描述**：测试SQL安全校验功能

**验收标准**：
- [ ] SELECT语句通过校验
- [ ] DROP语句被拦截
- [ ] DELETE语句被拦截
- [ ] SQL注入攻击被拦截
- [ ] 测试用例全部通过

**依赖任务**：T17-5
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T17-11：测试执行功能测试

**任务描述**：测试完整的测试执行流程

**验收标准**：
- [ ] 参数输入表单测试通过
- [ ] SQL执行测试通过
- [ ] 结果展示测试通过
- [ ] 异常处理测试通过
- [ ] E2E测试通过

**依赖任务**：T17-9
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

### US018：为报表分配角色权限（Story Points: 8）

#### 📱 前端任务

##### T18-1：权限分配模态框

**任务描述**：创建权限管理弹窗

**验收标准**：
- [ ] 模态框样式符合设计规范
- [ ] 模态框标题显示报表名称
- [ ] 模态框包含角色复选框列表
- [ ] 模态框底部包含保存和取消按钮
- [ ] 模态框关闭动画平滑

**依赖任务**：无
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T18-2：角色复选框

**任务描述**：创建ADMIN/DESIGNER/VIEWER角色复选框

**验收标准**：
- [ ] 3个角色复选框显示正常
- [ ] 角色名称和说明清晰
- [ ] ADMIN角色默认勾选且禁用
- [ ] 复选框状态管理正确
- [ ] 复选框响应用户操作

**依赖任务**：T18-1
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

##### T18-3：权限保存

**任务描述**：保存角色权限配置

**验收标准**：
- [ ] 收集勾选的角色ID
- [ ] 调用POST /api/v1/reports/{id}/permissions接口
- [ ] 保存成功显示Toast提示
- [ ] 保存失败显示错误信息
- [ ] 保存成功后关闭模态框

**依赖任务**：T18-2
**负责角色**：开发者A
**估算工时**：1h（乐观0.5h，最可能1h，悲观1.5h）

---

#### 🔧 后端任务

##### T18-4：权限分配API

**任务描述**：实现POST /api/v1/reports/{id}/permissions接口

**验收标准**：
- [ ] 接口路径为POST /api/v1/reports/{id}/permissions
- [ ] 接收角色ID数组（JSON）
- [ ] 先删除旧的权限配置
- [ ] 批量插入新的权限配置
- [ ] 使用事务保证一致性

**依赖任务**：无
**负责角色**：开发者B
**估算工时**：2h（乐观1.5h，最可能2h，悲观3h）

---

##### T18-5：权限查询API

**任务描述**：实现GET /api/v1/reports/{id}/permissions接口

**验收标准**：
- [ ] 接口路径为GET /api/v1/reports/{id}/permissions
- [ ] 查询report_permissions表
- [ ] 返回角色ID数组
- [ ] 响应时间<100ms
- [ ] 异常处理完善

**依赖任务**：T18-4
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T18-6：权限校验拦截器

**任务描述**：实现权限校验拦截器

**验收标准**：
- [ ] 实现HandlerInterceptor接口
- [ ] 从Session获取用户角色
- [ ] 查询用户是否有报表访问权限
- [ ] 无权限返回403错误
- [ ] 拦截器注册到Spring

**依赖任务**：T18-4
**负责角色**：开发者B
**估算工时**：3h（乐观2h，最可能3h，悲观4h）

---

#### 🧪 测试任务

##### T18-7：权限分配测试

**任务描述**：测试权限分配和查询功能

**验收标准**：
- [ ] 权限分配测试通过
- [ ] 权限查询测试通过
- [ ] 权限更新测试通过
- [ ] 事务回滚测试通过
- [ ] API测试通过

**依赖任务**：T18-5
**负责角色**：开发者A
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

##### T18-8：权限校验测试

**任务描述**：测试权限拦截器功能

**验收标准**：
- [ ] 有权限用户访问测试通过
- [ ] 无权限用户被拦截
- [ ] 403错误返回测试通过
- [ ] ADMIN角色访问所有报表
- [ ] E2E测试通过

**依赖任务**：T18-6
**负责角色**：开发者B
**估算工时**：1.5h（乐观1h，最可能1.5h，悲观2h）

---

## 📋 第2部分：任务详细清单

### US010任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T10-1 | CodeMirror集成 | 安装vue-codemirror 4.0.6 + CodeMirror 5.65.x | 编辑器显示正常 | 无 | 开发者A | 1h | 2h | 3h | **2h** |
| T10-2 | SQL语法高亮配置 | 配置text/x-mysql模式 | SQL关键字高亮显示 | T10-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T10-3 | 快捷键绑定 | Ctrl+S保存、Ctrl+Enter执行 | 快捷键响应正确 | T10-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T10-4 | 草稿自动保存 | 30秒自动保存到localStorage | 数据持久化成功 | T10-1 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T10-5 | 草稿保存API | POST /api/v1/report-drafts | API响应正常 | 无 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T10-6 | 草稿加载API | GET /api/v1/report-drafts/{id} | 数据加载正确 | T10-5 | 开发者B | 0.5h | 1h | 1.5h | **1h** |
| T10-7 | 前端组件测试 | 测试CodeMirror组件 | 测试用例通过 | T10-4 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T10-8 | API集成测试 | 测试草稿保存/加载 | 测试用例通过 | T10-6 | 开发者B | 0.5h | 1h | 1.5h | **1h** |

**US010小计**：11.5人时

---

### US011任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T11-1 | 基本信息表单 | 名称+描述输入框 | 表单显示正常 | 无 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T11-2 | 表单校验 | 必填+唯一性校验 | 校验提示正确 | T11-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T11-3 | 唯一性校验API | GET /api/v1/reports/check-name?name=xxx | API响应正确 | 无 | 开发者B | 0.5h | 1h | 1.5h | **1h** |
| T11-4 | 表单校验测试 | 测试必填+唯一性 | 测试用例通过 | T11-3 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |

**US011小计**：3.5人时

---

### US012任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T12-1 | 参数配置表格UI | 可编辑表格（参数名、类型、默认值等） | 表格显示正常 | 无 | 开发者A | 1.5h | 2h | 3h | **2h** |
| T12-2 | 参数类型切换 | 下拉选择STRING/NUMBER/DATE/DATETIME | 类型切换正常 | T12-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T12-3 | 参数增删改排序 | 添加、删除、上移、下移 | 操作响应正确 | T12-1 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T12-4 | SQL占位符提取 | 正则提取:paramName | 提取准确 | 无 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T12-5 | 参数配置保存API | POST /api/v1/reports/{id}/params | API响应正常 | 无 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T12-6 | SQL参数提取工具类 | Java工具类提取参数 | 提取准确 | 无 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T12-7 | 参数配置测试 | 测试增删改查 | 测试用例通过 | T12-5 | 开发者A | 1h | 1.5h | 2h | **1.5h** |

**US012小计**：11人时

---

### US013任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T13-1 | 列配置表格UI | 可编辑表格（字段名、显示名称等） | 表格显示正常 | 无 | 开发者A | 1.5h | 2h | 3h | **2h** |
| T13-2 | 列属性配置 | 显示名称、列宽、格式化类型 | 配置保存正确 | T13-1 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T13-3 | 列显示/隐藏 | Switch开关控制 | 开关响应正确 | T13-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T13-4 | 列排序功能 | 上移、下移 | 排序正确 | T13-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T13-5 | ResultSetMetaData列提取 | 从ResultSet提取列信息 | 提取准确 | 无 | 开发者B | 2h | 3h | 4h | **3h** |
| T13-6 | 自动提取列API | POST /api/v1/reports/extract-columns | API响应正常 | T13-5 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T13-7 | 列配置保存API | POST /api/v1/reports/{id}/columns | API响应正常 | 无 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T13-8 | 列配置测试 | 测试自动提取+配置 | 测试用例通过 | T13-7 | 开发者A | 1h | 1.5h | 2h | **1.5h** |

**US013小计**：13人时

---

### US014任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T14-1 | 多步骤表单整合 | Step1-4页面路由 | 步骤跳转正常 | T10-8, T11-4, T12-7, T13-8 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T14-2 | 表单数据收集 | 收集所有配置数据 | 数据结构正确 | T14-1 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T14-3 | 保存成功跳转 | 跳转到报表列表 | 跳转正常 | T14-2 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |
| T14-4 | 报表创建API | POST /api/v1/reports | API响应正常 | 无 | 开发者B | 2h | 3h | 4h | **3h** |
| T14-5 | 事务处理 | 报表+参数+列一起保存 | 事务回滚正常 | T14-4 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T14-6 | E2E测试 | 完整创建流程测试 | 测试用例通过 | T14-5 | 开发者A | 1h | 1.5h | 2h | **1.5h** |

**US014小计**：9.5人时

---

### US015任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T15-1 | 报表配置加载 | 加载报表+参数+列配置 | 数据加载正确 | T14-6 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T15-2 | 表单预填充 | 预填充Step1-4表单 | 预填充正确 | T15-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T15-3 | 更新提交 | 提交修改后的配置 | 更新成功 | T15-2 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |
| T15-4 | 报表配置查询API | GET /api/v1/reports/{id}/full | API响应正常 | 无 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T15-5 | 报表更新API | PUT /api/v1/reports/{id} | API响应正常 | T15-4 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T15-6 | 编辑功能测试 | 测试编辑+更新 | 测试用例通过 | T15-5 | 开发者A | 0.5h | 1h | 1.5h | **1h** |

**US015小计**：6.5人时

---

### US016任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T16-1 | 删除确认对话框 | 确认删除提示 | 对话框显示正常 | 无 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |
| T16-2 | 删除API调用 | 调用DELETE /api/v1/reports/{id} | 调用成功 | T16-1 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |
| T16-3 | 报表删除API | DELETE /api/v1/reports/{id} | 级联删除成功 | 无 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T16-4 | 删除功能测试 | 测试删除+级联 | 测试用例通过 | T16-3 | 开发者A | 0.5h | 1h | 1.5h | **1h** |

**US016小计**：3.5人时

---

### US017任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T17-1 | 参数输入对话框 | 动态生成参数表单 | 表单生成正确 | T12-7 | 开发者A | 2h | 3h | 4h | **3h** |
| T17-2 | 测试执行按钮 | 触发测试执行 | 按钮响应正常 | T17-1 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |
| T17-3 | 执行结果表格 | 展示前100行数据 | 表格显示正确 | T17-2 | 开发者A | 1.5h | 2h | 3h | **2h** |
| T17-4 | 执行信息显示 | 耗时+行数 | 信息显示正确 | T17-3 | 开发者A | 0.5h | 0.5h | 1h | **0.5h** |
| T17-5 | SQL安全校验 | 白名单+黑名单 | 危险SQL被拦截 | 无 | 开发者B | 2h | 3h | 4h | **3h** |
| T17-6 | PreparedStatement执行 | 参数化执行SQL | 防止SQL注入 | T17-5 | 开发者B | 1.5h | 2h | 3h | **2h** |
| T17-7 | ResultSet转JSON | 转换查询结果 | 数据格式正确 | T17-6 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T17-8 | 查询超时控制 | 5秒超时 | 超时正常中断 | T17-6 | 开发者B | 0.5h | 1h | 1.5h | **1h** |
| T17-9 | SQL测试执行API | POST /api/v1/reports/test-execute | API响应正常 | T17-8 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T17-10 | SQL安全测试 | 测试危险SQL拦截 | 测试用例通过 | T17-5 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T17-11 | 测试执行功能测试 | 完整测试流程 | 测试用例通过 | T17-9 | 开发者A | 1h | 1.5h | 2h | **1.5h** |

**US017小计**：18人时

---

### US018任务清单

| 任务ID | 任务名称 | 描述 | 验收标准 | 依赖任务 | 负责角色 | 估算（乐观） | 估算（最可能） | 估算（悲观） | **期望值** |
|--------|---------|------|---------|---------|---------|------------|--------------|------------|----------------|
| T18-1 | 权限分配模态框 | 权限管理弹窗 | 弹窗显示正常 | 无 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T18-2 | 角色复选框 | ADMIN/DESIGNER/VIEWER | 复选框响应正常 | T18-1 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T18-3 | 权限保存 | 保存角色权限 | 保存成功 | T18-2 | 开发者A | 0.5h | 1h | 1.5h | **1h** |
| T18-4 | 权限分配API | POST /api/v1/reports/{id}/permissions | API响应正常 | 无 | 开发者B | 1.5h | 2h | 3h | **2h** |
| T18-5 | 权限查询API | GET /api/v1/reports/{id}/permissions | API响应正常 | T18-4 | 开发者B | 1h | 1.5h | 2h | **1.5h** |
| T18-6 | 权限校验拦截器 | 拦截未授权访问 | 拦截正常 | T18-4 | 开发者B | 2h | 3h | 4h | **3h** |
| T18-7 | 权限分配测试 | 测试分配+查询 | 测试用例通过 | T18-5 | 开发者A | 1h | 1.5h | 2h | **1.5h** |
| T18-8 | 权限校验测试 | 测试未授权拦截 | 测试用例通过 | T18-6 | 开发者B | 1h | 1.5h | 2h | **1.5h** |

**US018小计**：13人时

---

## 📊 第3部分：工作量汇总

### 按用户故事汇总

| Story ID | 故事标题 | 任务数 | 估算工时 | 占比 |
|----------|---------|-------|---------|------|
| US010 | SQL编辑器实现（CodeMirror） | 8 | 11.5h | 13% |
| US011 | 报表基本信息配置 | 4 | 3.5h | 4% |
| US012 | 参数配置功能 | 7 | 11h | 12% |
| US013 | 列配置功能 | 8 | 13h | 15% |
| US014 | 报表创建功能 | 6 | 9.5h | 11% |
| US015 | 报表编辑功能 | 6 | 6.5h | 7% |
| US016 | 报表删除功能 | 4 | 3.5h | 4% |
| US017 | 报表预览（测试执行） | 11 | 18h | 20% |
| US018 | 为报表分配角色权限 | 8 | 13h | 15% |

**总计**：62个任务 / **89.5人时**

---

## 🎯 第4部分：团队产能分析

### 产能计算

```
团队可用产能 = 2人 × 6人时/天 × 5天 = 60人时
```

### 风险缓冲

```
CodeMirror集成风险：+10% = 60 × 0.1 = 6人时
SQL执行引擎风险：+5% = 60 × 0.05 = 3人时
```

### 实际可用产能

```
实际可用产能 = 60 - 6 - 3 = 51人时
产能利用率 = 89.5 / 60 = 149%（⚠️ 严重超载）
```

### 产能分配表

| 角色 | 成员 | 可用总产能 | 已分配前端任务工时 | 已分配后端任务工时 | **总分配工时** | **剩余产能** |
|------|------|-----------|-----------------|-----------------|--------------|--------------|
| 开发者A | 全栈（前端为主） | 30h | 40h | 0h | **40h** | **-10h**（❌超载） |
| 开发者B | 全栈（后端为主） | 30h | 0h | 49.5h | **49.5h** | **-19.5h**（❌严重超载） |

---

## ⚠️ 第5部分：Sprint范围调整建议（MoSCoW优先级法）

### 当前状态

- ❌ **总工时需求**：89.5人时
- ❌ **团队可用产能**：60人时（考虑风险后51人时）
- ❌ **产能缺口**：-29.5人时（**需要额外1.5周**）

### 优先级分析

| Story ID | 故事标题 | 工时 | 业务优先级 | 技术依赖 | **MoSCoW分类** |
|----------|---------|------|-----------|---------|-----------------|
| US010 | SQL编辑器实现 | 11.5h | ⭐⭐⭐ 核心 | 无 | **Must（必须）** |
| US011 | 报表基本信息配置 | 3.5h | ⭐⭐⭐ 核心 | 无 | **Must（必须）** |
| US012 | 参数配置功能 | 11h | ⭐⭐⭐ 核心 | US010 | **Must（必须）** |
| US013 | 列配置功能 | 13h | ⭐⭐⭐ 核心 | US010 | **Must（必须）** |
| US014 | 报表创建功能 | 9.5h | ⭐⭐⭐ 核心 | US010-US013 | **Must（必须）** |
| US017 | 报表预览（测试执行） | 18h | ⭐⭐⭐ 核心 | US012-US013 | **Must（必须）** |
| US015 | 报表编辑功能 | 6.5h | ⭐⭐ 重要 | US014 | **Should（应该）** |
| US016 | 报表删除功能 | 3.5h | ⭐⭐ 重要 | US014 | **Should（应该）** |
| US018 | 为报表分配角色权限 | 13h | ⭐⭐ 重要 | US014 | **Should（应该）** |

---

### 方案1：MVP最小范围（推荐）

**保留故事**：US010 + US011 + US012 + US013 + US014 + US017

**总工时**：66.5人时

**评估**：
- ❌ 产能利用率：66.5 / 60 = **111%**（仍超载10.5人时）
- ⚠️ 风险：仍然需要加班或延期1天

**交付物**：
- ✅ 设计者能够创建报表（基本信息+SQL+参数+列配置）
- ✅ 设计者能够测试执行报表查看结果
- ❌ 无法编辑、删除报表（下个Sprint）
- ❌ 无法配置权限（下个Sprint）

---

### 方案2：调整至健康产能（强烈推荐）

**保留故事**：US010 + US011 + US012 + US014 + US017（**延后US013列配置**）

**总工时**：53.5人时

**评估**：
- ✅ 产能利用率：53.5 / 60 = **89%**（健康水平）
- ✅ 风险缓冲：6.5人时（应对突发问题）

**交付物**：
- ✅ 设计者能够创建报表（基本信息+SQL+参数配置）
- ✅ 设计者能够测试执行报表（SQL结果以JSON展示，前端暂不配置列格式化）
- ⚠️ 列配置功能延后到下个Sprint（用户端展示时使用默认列配置）

**技术方案调整**：
- US017测试执行：直接展示SQL原始结果（JSON格式），不依赖US013列配置
- 前端临时方案：使用Element UI Table自动推断列（基于JSON字段名）
- 下个Sprint完成US013后，重构前端动态列渲染

---

### 方案3：延长Sprint（备选）

**保留所有故事**：US010-US018

**总工时**：89.5人时

**评估**：
- Sprint延长至：89.5 / 12人时/天 ≈ **7.5天（约1.5周）**
- 产能利用率：89.5 / 90 = **99%**（几乎满负荷）

**风险**：
- ❌ Sprint过长，反馈周期延迟
- ❌ 团队疲劳，代码质量下降

---

### ✅ 最终建议

**采用方案2**：调整至健康产能（53.5人时）

**Sprint Backlog（最终版）**：

| Story ID | 故事标题 | 工时 | MoSCoW |
|----------|---------|------|--------|
| US010 | SQL编辑器实现（CodeMirror） | 11.5h | Must |
| US011 | 报表基本信息配置 | 3.5h | Must |
| US012 | 参数配置功能 | 11h | Must |
| US014 | 报表创建功能 | 9.5h | Must |
| US017 | 报表预览（测试执行） | 18h | Must |

**延后到下个Sprint**：
- US013（列配置功能，13h）
- US015（报表编辑功能，6.5h）
- US016（报表删除功能，3.5h）
- US018（权限分配功能，13h）

---

## 📅 第6部分：任务依赖关系图

### 关键路径

```
US010（SQL编辑器）
  ↓
US011（基本信息配置）
  ↓
US012（参数配置）
  ↓
US014（报表创建）
  ↓
US017（报表预览/测试执行）
```

### 并行开发建议

**Day 1-2**（12h）：
- 开发者A：US010（SQL编辑器，11.5h）
- 开发者B：US011（基本信息配置，3.5h）+ US012后端任务（T12-5、T12-6，3h）

**Day 3**（6h）：
- 开发者A：US012前端任务（T12-1至T12-4，6h）
- 开发者B：US014后端任务（T14-4、T14-5，4.5h）

**Day 4**（6h）：
- 开发者A：US014前端任务（T14-1至T14-3，3.5h）+ US012测试（T12-7，1.5h）
- 开发者B：US017后端任务前半部分（T17-5至T17-7，6.5h）

**Day 5**（6h）：
- 开发者A：US017前端任务（T17-1至T17-4，6h）
- 开发者B：US17后端任务后半部分（T17-8至T17-10，4h）+ US014测试（T14-6，1.5h）

**加班/缓冲时间**：US017测试（T17-11，1.5h）

---

## ✅ 第7部分：验收标准检查清单

### 每个用户故事的DoD（Definition of Done）

- [ ] **代码完成**：所有任务代码提交到Git
- [ ] **单元测试通过**：测试覆盖率≥80%
- [ ] **集成测试通过**：API接口测试通过
- [ ] **前端功能测试**：UI交互正常
- [ ] **代码审查**：至少1人审查通过
- [ ] **文档更新**：API文档/用户手册更新
- [ ] **PO验收**：产品经理确认验收标准达成

---

## 📝 第8部分：风险登记表

| 风险ID | 风险描述 | 概率 | 影响 | 应对策略 | 负责人 |
|--------|---------|------|------|---------|--------|
| R1 | CodeMirror集成问题（版本兼容） | 中 | 高 | 预留10%缓冲时间，提前技术预研 | 开发者A |
| R2 | SQL执行引擎性能问题 | 低 | 高 | 查询超时控制5秒，限制返回100行 | 开发者B |
| R3 | ResultSetMetaData提取失败 | 中 | 中 | 降级方案：手动配置列（跳过US013） | 开发者B |
| R4 | 产能不足（89.5h > 60h） | 高 | 高 | ✅ 采用方案2，延后US013/US015/US016/US018 | Scrum Master |
| R5 | 团队成员请假/生病 | 低 | 高 | 预留25%缓冲产能（15h） | Scrum Master |

---

## 🎯 总结

### 核心结论

1. **原始估算**：89.5人时（9个故事）
2. **团队产能**：60人时（5天Sprint）
3. **产能缺口**：-29.5人时（**超载50%**）
4. **调整方案**：延后4个故事（US013/US015/US016/US018）
5. **调整后工时**：53.5人时（5个故事）
6. **产能利用率**：89%（健康水平）

### Sprint目标（调整后）

**Sprint Goal**：完成报表创建的核心流程（基本信息+SQL编辑+参数配置+测试执行），为下个Sprint的列配置和权限管理打基础。

**交付物**：
- ✅ 设计者能够使用SQL编辑器编写查询语句
- ✅ 设计者能够配置报表基本信息（名称+描述）
- ✅ 设计者能够配置查询参数（参数名、类型、默认值）
- ✅ 设计者能够创建并保存报表
- ✅ 设计者能够测试执行报表查看结果（JSON格式）

**下个Sprint规划**：
- US013（列配置功能，13h）
- US015（报表编辑功能，6.5h）
- US016（报表删除功能，3.5h）
- US018（权限分配功能，13h）
- **总计**：36h（约3天，团队2人可完成）

---

**文档版本**：v1.0
**生成日期**：2025-01-25
**下一步行动**：
1. 产品经理确认方案2的Sprint范围调整
2. 召开Sprint计划会，团队成员确认任务分配
3. Day 1开始执行，每日站会跟踪进度
4. Sprint结束后召开回顾会，评估估算准确性
