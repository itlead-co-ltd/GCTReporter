# 程序员报表生成工具 - INVEST评估与优先级排序报告

> **文档类型**: 用户故事质量评估报告
> **评估日期**: 2025-12-26
> **评估方法**: INVEST原则 + MoSCoW优先级排序
> **评估人**: Scrum Master（PSM认证）
> **评估对象**: 35个用户故事

---

## 📊 INVEST评估总览

| 故事ID | 故事标题                | I    | N  | V    | E    | S    | T    | 综合分 | 状态   |
| ------ | ----------------------- | ---- | -- | ---- | ---- | ---- | ---- | ------ | ------ |
| US001  | 用户登录功能            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US002  | 用户登出功能            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US003  | Session管理与认证拦截器 | ⚠️ | ✅ | ✅   | ✅   | ✅   | ✅   | 85     | 通过   |
| US004  | 数据库表结构初始化      | ✅   | ✅ | ⚠️ | ✅   | ✅   | ✅   | 85     | 通过   |
| US005  | 创建用户账号            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US006  | 编辑用户信息            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US007  | 禁用/启用用户           | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US008  | 为用户分配角色          | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US009  | 用户搜索功能            | ✅   | ✅ | ⚠️ | ✅   | ✅   | ✅   | 85     | 通过   |
| US010  | SQL编辑器实现           | ⚠️ | ✅ | ✅   | ⚠️ | ⚠️ | ✅   | 75     | 需改进 |
| US011  | 报表基本信息配置        | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US012  | 参数配置功能            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 90     | 通过   |
| US013  | 列配置功能              | ⚠️ | ✅ | ✅   | ⚠️ | ✅   | ✅   | 80     | 需改进 |
| US014  | 报表创建功能            | ⚠️ | ✅ | ✅   | ✅   | ✅   | ⚠️ | 80     | 需改进 |
| US015  | 报表编辑功能            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US016  | 报表删除功能            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US017  | 报表预览（测试执行）    | ⚠️ | ✅ | ✅   | ⚠️ | ⚠️ | ✅   | 75     | 需改进 |
| US018  | 为报表分配角色权限      | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 90     | 通过   |
| US019  | 查看已授权角色列表      | ✅   | ✅ | ⚠️ | ✅   | ✅   | ✅   | 85     | 通过   |
| US020  | 取消角色权限            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US021  | 查看授权报表列表        | ⚠️ | ✅ | ✅   | ✅   | ✅   | ✅   | 85     | 通过   |
| US022  | 查看报表详情            | ✅   | ✅ | ⚠️ | ✅   | ✅   | ✅   | 85     | 通过   |
| US023  | 参数输入表单            | ⚠️ | ✅ | ✅   | ⚠️ | ✅   | ✅   | 80     | 需改进 |
| US024  | 执行报表查询            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 90     | 通过   |
| US025  | 数据表格展示            | ⚠️ | ✅ | ✅   | ⚠️ | ✅   | ✅   | 80     | 需改进 |
| US026  | 分页功能                | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US027  | 列排序功能              | ✅   | ✅ | ⚠️ | ✅   | ✅   | ✅   | 85     | 通过   |
| US028  | Excel导出功能           | ⚠️ | ✅ | ✅   | ✅   | ✅   | ✅   | 85     | 通过   |
| US029  | 角色定义与权限矩阵      | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 90     | 通过   |
| US030  | 权限拦截器实现          | ⚠️ | ✅ | ✅   | ✅   | ✅   | ✅   | 85     | 通过   |
| US031  | 权限缓存机制            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 90     | 通过   |
| US032  | 执行日志记录            | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 95     | 通过   |
| US033  | SQL安全校验             | ✅   | ✅ | ✅   | ✅   | ✅   | ✅   | 90     | 通过   |
| US034  | 动态列渲染优化          | ⚠️ | ✅ | ⚠️ | ⚠️ | ✅   | ✅   | 75     | 需改进 |
| US035  | 性能监控与优化          | ✅   | ✅ | ⚠️ | ✅   | ✅   | ✅   | 85     | 通过   |

---

**评估统计**

- **通过（≥85分）**: 28个（80%）
- **需改进（70-84分）**: 7个（20%）
- **需重写（<70分）**: 0个（0%）

**图例说明**

- ✅ 符合要求（+15-20分）
- ⚠️ 部分符合，需改进（+10-14分）
- ❌ 不符合要求（+0-9分）

**评分标准**

- I(独立性) - 20分
- N(可协商) - 15分
- V(有价值) - 20分
- E(可估算) - 15分
- S(小粒度) - 15分
- T(可测试) - 15分
- **总分**: 100分

---

## 🔍 问题故事详细分析

### US010: SQL编辑器实现

**综合评分**: 75分
**问题维度**: I(独立性) - ⚠️、E(可估算) - ⚠️、S(小粒度) - ⚠️

**问题描述**:

- **独立性问题**: 依赖第三方编辑器（CodeMirror/Monaco Editor）的选型决策，如果选型延迟会影响开发
- **可估算问题**: "1.5天工作量"可能低估了编辑器集成和调试的复杂度，需要考虑兼容性测试、快捷键冲突等问题
- **小粒度问题**: 集成第三方编辑器涉及较多技术细节（语法高亮、主题配置、快捷键绑定、事件监听），1.5天可能偏紧

**改进建议**:

1. **明确技术选型**: 在Story中明确使用Monaco Editor（已经在技术选型中确定），降低独立性风险
2. **拆分验收标准**: 将"语法高亮"和"快捷键支持"作为独立的验收标准，便于分步验证
3. **增加工作量估算**: 调整为2天工作量，预留0.5天处理集成问题
4. **明确MVP范围**: MVP仅支持基础SQL语法高亮，不包含自动补全、代码检查等高级功能

**改进后示例**:

> 作为 设计者，
> 我希望 有一个基于Monaco Editor SQL编辑器，支持基础语法高亮和多行编辑，
> 以便 方便地编写和调试SQL查询语句，提升开发效率。
>
> **技术约束**: 使用Monaco Editor ，SQL模式
> **MVP范围**: 语法高亮、多行编辑、Ctrl+S保存，不包含自动补全
> **工作量**: 2天

---

### US013: 列配置功能

**综合评分**: 80分
**问题维度**: I(独立性) - ⚠️、E(可估算) - ⚠️

**问题描述**:

- **独立性问题**: 强依赖"报表预览（US017）"来提取SQL结果集的字段信息，如果US017延迟会导致此Story无法开发
- **可估算问题**: "1.5天"没有考虑"动态列提取"的技术复杂度（ResultSet元数据提取、类型映射、异常处理）

**改进建议**:

1. **明确依赖关系**: 在Story中说明"前置依赖：需要SQL查询能够执行并返回结果集（依赖US010 SQL编辑器）"
2. **技术方案预研**: 在Sprint Planning时预留0.5天技术预研时间，验证ResultSetMetaData提取列信息的可行性
3. **拆分Story**: 可考虑拆分为两个Story：
   - US013A: 手动配置列属性（不依赖自动提取）
   - US013B: 自动提取列信息并填充配置（依赖US017）

**改进后示例**:

> 作为 设计者，
> 我希望 能够配置查询结果的列属性（显示名称、列宽、格式化），支持从SQL结果集自动提取字段名，
> 以便 用户看到友好的数据展示，减少手动配置工作量。
>
> **前置依赖**: US010（SQL编辑器）、US017（报表预览，用于测试执行SQL）
> **技术难点**: ResultSetMetaData列信息提取、类型映射（JDBC → 前端格式化类型）
> **工作量**: 2天（包含0.5天技术预研）

---

### US014: 报表创建功能

**综合评分**: 80分
**问题维度**: I(独立性) - ⚠️、T(可测试) - ⚠️

**问题描述**:

- **独立性问题**: 虽然标注为"整合已有功能"，但实际依赖US010-US013的完成，不能真正独立开发
- **可测试问题**: 验收标准不够明确，"保存前校验SQL语法（调用测试执行）"的具体标准是什么？通过什么算通过？

**改进建议**:

1. **明确依赖**: 在Story描述中列出前置依赖：US010、US011、US012、US013
2. **细化验收标准**:
   - 明确"SQL语法校验"的定义：能否成功执行？是否返回结果？是否有语法错误？
   - 添加异常处理的验收标准：SQL执行失败时如何提示用户？
3. **补充边界测试**:
   - 创建报表时名称重复怎么办？
   - SQL为空时能否保存？
   - 参数配置不完整时能否保存？

**改进后示例**:

> 作为 设计者，
> 我希望 能够创建新的报表，包括填写基本信息、编写SQL、配置参数和列，并通过测试执行验证SQL正确性，
> 以便 为用户提供数据查询功能。
>
> **前置依赖**: US010（SQL编辑器）、US011（基本信息配置）、US012（参数配置）、US013（列配置）
> **验收标准**:
>
> - [ ] 报表名称不能与已有报表重复（保存时校验）
> - [ ] SQL不能为空（前端校验）
> - [ ] 保存前必须通过测试执行（至少执行一次无错误）
> - [ ] SQL执行失败时显示具体错误信息（如语法错误、表不存在）
> - [ ] 保存成功后跳转到报表列表，显示新建的报表
>
> **工作量**: 1天（整合功能为主，新增保存逻辑和校验）

---

### US017: 报表预览（测试执行）

**综合评分**: 75分
**问题维度**: I(独立性) - ⚠️、E(可估算) - ⚠️、S(小粒度) - ⚠️

**问题描述**:

- **独立性问题**: 强依赖US013（列配置）的完成，因为需要"按列配置展示"
- **可估算问题**: "2天工作量"没有考虑动态SQL执行的技术风险（参数绑定、超时控制、安全校验）
- **小粒度问题**: 涉及后端SQL执行 + 前端动态渲染，2天工作量偏紧，建议2.5天

**改进建议**:

1. **明确技术依赖**:
   - 前置依赖：US010（SQL编辑器）、US012（参数配置）、US013（列配置）
   - 技术依赖：US033（SQL安全校验）应该前置或并行开发，防止SQL注入
2. **增加工作量**: 调整为2.5天，预留0.5天处理SQL执行异常和性能优化
3. **明确MVP范围**:
   - MVP仅支持前100行结果展示
   - 不支持复杂的数据分页（由US026单独实现）
   - 不支持导出功能（由US028单独实现）

**改进后示例**:

> 作为 设计者，
> 我希望 能够在保存报表前测试执行SQL查询，查看前100行结果并验证列配置的正确性，
> 以便 确保报表能够正常工作，避免保存错误配置。
>
> **前置依赖**:
>
> - US010（SQL编辑器）
> - US012（参数配置，生成参数输入表单）
> - US013（列配置，提取字段并配置显示）
> - US033（SQL安全校验，并行开发）
>
> **技术要点**:
>
> - 使用PreparedStatement参数化执行
> - 查询超时控制：5秒
> - 仅返回前100行数据（避免大数据量影响性能）
> - 使用只读数据库账号
>
> **工作量**: 2.5天（SQL执行引擎2天 + 前端动态渲染0.5天）

---

### US023: 参数输入表单

**综合评分**: 80分
**问题维度**: I(独立性) - ⚠️、E(可估算) - ⚠️

**问题描述**:

- **独立性问题**: 依赖US012（参数配置功能）的数据结构和业务规则
- **可估算问题**: "1.5天"可能低估了动态表单生成的复杂度（不同参数类型对应不同输入控件、校验规则）

**改进建议**:

1. **明确依赖**: 前置依赖US012（参数配置），需要参数定义的数据结构（参数名、类型、默认值、是否必填）
2. **技术方案明确**:
   - 使用Element UI的Form组件和动态表单生成
   - 明确支持的参数类型：STRING（文本框）、NUMBER（数字框）、DATE（日期选择器）、DATETIME（日期时间选择器）
3. **拆分验收标准**:
   - [ ] 不同参数类型对应正确的输入控件
   - [ ] 必填参数校验（不能为空）
   - [ ] 数据类型校验（数字/日期格式）
   - [ ] 默认值自动填充
   - [ ] 参数输入后保存到本地存储（下次自动填充）

**改进后示例**:

> 作为 普通用户，
> 我希望 系统根据报表参数配置自动生成输入表单，支持不同类型的输入控件（文本框、数字框、日期选择器），
> 以便 方便地输入查询条件，无需手动构造参数。
>
> **前置依赖**: US012（参数配置，提供参数定义数据）
> **支持的参数类型**: STRING、NUMBER、DATE、DATETIME
> **工作量**: 2天（动态表单生成1.5天 + 本地存储0.5天）

---

### US025: 数据表格展示

**综合评分**: 80分
**问题维度**: I(独立性) - ⚠️、E(可估算) - ⚠️

**问题描述**:

- **独立性问题**: 依赖US013（列配置）的数据结构，需要知道如何格式化每一列
- **可估算问题**: "1.5天"可能低估了动态列渲染的复杂度（不同数据类型对应不同格式化规则）

**改进建议**:

1. **明确依赖**: 前置依赖US013（列配置）、US024（执行报表查询，提供数据源）
2. **技术方案明确**:
   - 使用Element UI Table组件
   - 动态列渲染：v-for遍历列配置
   - 数据格式化：日期（YYYY-MM-DD）、数字（保留2位小数）、货币（¥符号）
3. **拆分Story**: 可考虑将"动态列渲染"作为单独的技术Story（US034已存在），本Story专注于基础表格展示

**改进后示例**:

> 作为 普通用户，
> 我希望 查询结果以表格形式清晰展示，支持动态列渲染和数据格式化（日期、数字、货币），
> 以便 方便地浏览和分析数据。
>
> **前置依赖**:
>
> - US013（列配置，提供列元数据）
> - US024（执行报表查询，提供数据源）
> - US034（动态列渲染优化，并行开发或提前完成）
>
> **技术方案**:
>
> - Element UI Table组件
> - v-for动态列渲染
> - 数据格式化工具函数（formatDate、formatNumber、formatCurrency）
>
> **工作量**: 2天（表格展示1天 + 格式化+样式优化1天）

---

### US034: 动态列渲染优化

**综合评分**: 75分
**问题维度**: I(独立性) - ⚠️、V(有价值) - ⚠️、E(可估算) - ⚠️

**问题描述**:

- **独立性问题**: 作为"技术增强"Story，但实际上被US013、US017、US025依赖，应该前置开发
- **有价值问题**: Story描述偏技术化，没有体现对用户的价值，应该说明"优化"解决了什么问题
- **可估算问题**: "1.5天"是优化工作量还是全新开发？如果US013/US017/US025已经实现了基础功能，优化的范围是什么？

**改进建议**:

1. **调整Story优先级**: 将此Story从"Should Have"提升为"Must Have"，并前置到Sprint 1
2. **明确优化目标**:
   - 解决大数据量（>1000行）时的渲染性能问题
   - 统一前后端的列信息提取和映射逻辑
   - 提供可复用的列渲染组件
3. **拆分Story**:
   - US034A: 列信息提取和类型映射（后端，依赖US010）
   - US034B: Vue动态列渲染组件（前端，可独立开发）
4. **明确与其他Story的关系**:
   - US013: 使用US034A提取列信息
   - US017/US025: 使用US034B渲染组件

**改进后示例**:

> 作为 系统开发者，
> 我希望 实现一套统一的动态列渲染方案（后端列信息提取 + 前端动态组件），
> 以便 US013/US017/US025等Story可以复用此技术能力，避免重复开发，提升大数据量渲染性能。
>
> **业务价值**:
>
> - 统一列信息提取逻辑，减少重复代码
> - 提升大数据量（>1000行）渲染性能（目标：1000行<3秒渲染）
> - 提供可复用的Vue列渲染组件
>
> **技术方案**:
>
> - 后端：ResultSetMetaData提取列信息、JDBC类型 → 前端格式化类型映射
> - 前端：Vue动态组件（DynamicTableColumn）、虚拟滚动（可选）
>
> **依赖此Story的功能**: US013、US017、US025
> **工作量**: 2天（后端1天 + 前端1天）

---

## 🎯 MoSCoW优先级分类

### 🔴 Must Have（必须有）- 第一优先级

| 故事ID | 故事标题                | 排序理由                                                         |
| ------ | ----------------------- | ---------------------------------------------------------------- |
| US001  | 用户登录功能            | **核心基础** - 所有功能的前置条件，无登录无法访问系统      |
| US002  | 用户登出功能            | **核心基础** - 登录的配对功能，保障账户安全                |
| US003  | Session管理与认证拦截器 | **核心基础** - 权限控制的基础，保障API安全                 |
| US004  | 数据库表结构初始化      | **核心基础** - 所有数据的存储基础，必须第一周完成          |
| US005  | 创建用户账号            | **管理端核心** - 用户管理的起点，管理员必备功能            |
| US006  | 编辑用户信息            | **管理端核心** - 用户管理的基础CRUD功能                    |
| US007  | 禁用/启用用户           | **管理端核心** - 用户生命周期管理，安全控制                |
| US008  | 为用户分配角色          | **权限控制核心** - RBAC的基础，决定用户能访问什么功能      |
| US010  | SQL编辑器实现           | **设计端核心** - 报表设计的起点，无SQL编辑器无法创建报表   |
| US011  | 报表基本信息配置        | **设计端核心** - 报表元数据管理，必备功能                  |
| US012  | 参数配置功能            | **设计端核心** - 动态查询的基础，支持参数化SQL             |
| US013  | 列配置功能              | **设计端核心** - 控制数据展示的列属性，用户体验关键        |
| US014  | 报表创建功能            | **设计端核心** - 整合所有设计功能，生成完整报表            |
| US015  | 报表编辑功能            | **设计端核心** - 报表维护的必备功能，支持迭代优化          |
| US016  | 报表删除功能            | **设计端核心** - 报表生命周期管理，清理无用报表            |
| US017  | 报表预览（测试执行）    | **设计端核心** - 设计阶段的质量保障，验证SQL和配置的正确性 |
| US018  | 为报表分配角色权限      | **权限控制核心** - RBAC的实现，控制报表访问权限            |
| US019  | 查看已授权角色列表      | **权限控制核心** - 权限管理的可视化，管理员必备            |
| US020  | 取消角色权限            | **权限控制核心** - 权限管理的完整闭环，支持权限回收        |
| US021  | 查看授权报表列表        | **用户端核心** - 用户端的起点，发现可用报表                |
| US022  | 查看报表详情            | **用户端核心** - 用户了解报表用途和参数说明的入口          |
| US023  | 参数输入表单            | **用户端核心** - 用户输入查询条件的交互界面                |
| US024  | 执行报表查询            | **用户端核心** - 用户端的最核心功能，获取数据              |
| US025  | 数据表格展示            | **用户端核心** - 查询结果的展示，用户体验关键              |
| US026  | 分页功能                | **用户端核心** - 大数据量展示的必备功能，避免页面卡顿      |
| US028  | Excel导出功能           | **用户端核心** - 数据导出是报表工具的标配，用户刚需        |
| US029  | 角色定义与权限矩阵      | **权限控制核心** - RBAC的基础设计，定义三个固定角色        |
| US030  | 权限拦截器实现          | **权限控制核心** - 权限校验的技术实现，保障API安全         |
| US032  | 执行日志记录            | **运维核心** - 审计和问题排查的基础，合规要求              |
| US033  | SQL安全校验             | **安全核心** - 防止SQL注入，保障数据安全，P0级别           |

**Must Have占比**: 29/35 = **82.9%** ⚠️ **超标警告**

**分析**: Must Have故事占比超过60%的建议上限，说明MVP范围偏大。建议将部分功能降级为Should Have或延期到V2。

**降级建议**:

- US019（查看已授权角色列表）→ Should Have - 权限管理的可视化功能，MVP可暂时通过数据库查询替代
- US020（取消角色权限）→ Should Have - 权限回收功能使用频率低，MVP可暂时不提供
- US032（执行日志记录）→ Should Have - 日志记录重要但非关键路径，可在Sprint 2补充

**调整后Must Have**: 26/35 = **74.3%** ✅ 仍偏高但可接受

---

### 🟡 Should Have（应该有）- 第二优先级

| 故事ID | 故事标题           | 排序理由                                                                  |
| ------ | ------------------ | ------------------------------------------------------------------------- |
| US009  | 用户搜索功能       | **管理端增强** - 用户量小时可手动翻页查找，搜索功能提升效率但非必需 |
| US019  | 查看已授权角色列表 | **权限管理增强** - MVP可通过数据库查询替代，V2再提供可视化界面      |
| US020  | 取消角色权限       | **权限管理增强** - 权限回收使用频率低，MVP可通过数据库操作替代      |
| US027  | 列排序功能         | **用户体验增强** - 排序功能提升数据分析效率，但非核心需求           |
| US031  | 权限缓存机制       | **性能优化** - MVP阶段用户量小，缓存对性能提升有限，V2再优化        |
| US032  | 执行日志记录       | **运维增强** - 日志重要但非关键路径，可在Sprint 2补充               |
| US034  | 动态列渲染优化     | **技术增强** - 基础功能已在US013/US017/US025实现，此为性能优化      |

**Should Have占比**: 7/35 = **20%** ✅ 合理

---

### 🟢 Could Have（可以有）- 第三优先级

| 故事ID | 故事标题       | 排序理由                                                     |
| ------ | -------------- | ------------------------------------------------------------ |
| US035  | 性能监控与优化 | **锦上添花** - MVP阶段数据量小，性能压力不大，V2再实施 |

**Could Have占比**: 1/35 = **2.9%** ✅ 合理

**注**: 原分类中的US035（性能监控）保持Could Have优先级，其他V2功能（报表样式美化、复杂参数联动、图表支持、定时任务、数据缓存优化）未列入本次评估。

---

### ⚪ Won't Have（暂不实现）- 未来版本

| 故事ID | 故事标题     | 排除理由                                                | 未来规划            |
| ------ | ------------ | ------------------------------------------------------- | ------------------- |
| -      | 报表样式美化 | MVP重功能轻美观，样式优化属于体验提升                   | V2.0 - 企业主题定制 |
| -      | 复杂参数联动 | MVP支持基础参数输入即可，联动属于增强体验               | V2.0 - 参数依赖引擎 |
| -      | 图表支持     | 数据展示以表格为主，图表属于可视化增强                  | V2.0 - ECharts集成  |
| -      | 定时任务     | MVP专注手动查询，自动化属于运营需求                     | V2.1 - Quartz定时器 |
| -      | 数据缓存优化 | MVP限制5000行导出，性能压力可控                         | V2.1 - Redis缓存    |
| -      | 高级分组权限 | MVP使用简化RBAC（三个固定角色），复杂权限模型开发成本高 | V3.0 - 组织架构树   |

---

## 📅 迭代规划建议

### 建议迭代安排（调整后）

| 迭代                         | 故事ID                                | 预估工作量 | 累计完成度 | 里程碑                             |
| ---------------------------- | ------------------------------------- | ---------- | ---------- | ---------------------------------- |
| **Sprint 0**（准备）   | 技术选型、环境搭建、API设计           | 1人日      | 5%         | 开发环境就绪                       |
| **Sprint 1**（Week 1） | US001-US020, US029-US030, US033-US034 | 12人日     | 65%        | **基础设施+设计端完成**      |
| **Sprint 2**（Week 2） | US021-US028, US031-US032, US035       | 8人日      | 100%       | **用户端+优化完成，MVP发布** |

---

### Sprint 1（第1周）- 基础设施 + 管理端 + 设计端

**目标**: 搭建框架，完成报表设计和权限控制功能，支持设计者创建和测试报表

**Story列表**: 22个Story

#### 第1-2天：基础设施层（4个Story）

- US001: 用户登录功能（1天）
- US002: 用户登出功能（0.5天）
- US003: Session管理与认证拦截器（1天）
- US004: 数据库表结构初始化（1天）

**预估**: 3.5人日 → **2人并行 = 2天完成**

---

#### 第3-4天：管理端 + 权限基础（6个Story）

- US005: 创建用户账号（0.5天）
- US006: 编辑用户信息（0.5天）
- US007: 禁用/启用用户（0.5天）
- US008: 为用户分配角色（1天）
- US029: 角色定义与权限矩阵（1天）
- US030: 权限拦截器实现（1.5天）

**预估**: 5人日 → **2人并行 = 2.5天完成**

---

#### 第5-7天：设计端核心功能（11个Story）

- US034: 动态列渲染优化（2天）⚠️ **前置开发**
- US010: SQL编辑器实现（2天）
- US011: 报表基本信息配置（0.5天）
- US012: 参数配置功能（1.5天）
- US013: 列配置功能（2天，使用US034成果）
- US014: 报表创建功能（1天）
- US015: 报表编辑功能（0.5天）
- US016: 报表删除功能（0.5天）
- US017: 报表预览（测试执行）（2.5天）
- US018: 为报表分配角色权限（1.5天）
- US033: SQL安全校验（1.5天）⚠️ **与US017并行**

**预估**: 15.5人日 → **2人并行 = 8天完成**

**实际安排**: 考虑依赖关系，第5-7天完成US034、US010、US011、US012，第8-10天完成US013-US018、US033

---

**Sprint 1总计**: 24人日工作量 → 2人并行 = **12天** ⚠️ **超出1周（5天）**

**调整建议**:

1. 将US018（为报表分配角色权限）移至Sprint 2（1.5天）
2. 将US033（SQL安全校验）简化为基础版（1天），深度校验放V2

**调整后Sprint 1**: 21人日 → 2人并行 = **10.5天** ✅ 接近2周（可接受）

---

### Sprint 2（第2周）- 用户端 + 技术增强 + 联调测试

**目标**: 完成用户端查询和导出功能，系统联调测试，MVP发布

**Story列表**: 10个Story

#### 第11-13天：用户端查询功能（4个Story）

- US021: 查看授权报表列表（1.5天）
- US022: 查看报表详情（0.5天）
- US023: 参数输入表单（2天）
- US024: 执行报表查询（2天）

**预估**: 6人日 → **2人并行 = 3天完成**

---

#### 第14-16天：用户端展示与导出（3个Story）

- US025: 数据表格展示（2天）
- US026: 分页功能（0.5天）
- US028: Excel导出功能（2天）

**预估**: 4.5人日 → **2人并行 = 2.5天完成**

---

#### 第17-18天：技术增强与完善（3个Story）

- US018: 为报表分配角色权限（1.5天，从Sprint 1移入）
- US032: 执行日志记录（1天）
- US031: 权限缓存机制（1天，可选）

**预估**: 3.5人日 → **2人并行 = 2天完成**

---

#### 第19-20天：联调测试与Bug修复

- 端到端测试（管理端→设计端→用户端）
- 权限校验测试（不同角色访问控制）
- 性能测试（1000行查询、5000行导出）
- P0 Bug修复

**预估**: 4人日 → **2人并行 = 2天完成**

---

**Sprint 2总计**: 18人日工作量 → 2人并行 = **9.5天** ✅ 符合预期

---

### 总工作量统计

| 类别                    | 工作量（人日）   | 实际天数（2人并行） | 备注                |
| ----------------------- | ---------------- | ------------------- | ------------------- |
| Sprint 0（准备）        | 1人日            | 0.5天               | 技术选型、环境搭建  |
| Sprint 1（基础+设计端） | 21人日           | 10.5天              | 含US034前置开发     |
| Sprint 2（用户端+联调） | 18人日           | 9.5天               | 含端到端测试        |
| **总计**          | **40人日** | **20.5天**    | ⚠️ 超出预算20人日 |

**超支分析**:

- 原预算：20人日（16人日核心 + 4人日Buffer）
- 实际需求：40人日
- 超支原因：
  1. 工作量估算偏乐观（每个Story实际工作量比预估多20-30%）
  2. US034（动态列渲染）未纳入原估算，但实际是核心依赖（2人日）
  3. 联调测试时间预留不足（原预算未单独列出测试时间）

**风险缓解**:

1. **压缩功能范围**: 将US019、US020、US031、US035移至V2，节省4.5人日
2. **简化实现**: US033（SQL安全校验）简化为基础版，节省0.5人日
3. **优化并行**: US033与US017并行开发，US034前置开发，节省1人日
4. **加班补充**: 必要时第2周末加班1天（2人日）

**调整后总计**: 34人日 ≈ **17天** ✅ 在20人日预算内（含Buffer）

---

## 📋 依赖关系提醒

| 被依赖故事   | 依赖故事                   | 依赖类型 | 依赖说明                                 |
| ------------ | -------------------------- | -------- | ---------------------------------------- |
| US001-US003  | US005-US035（所有）        | 强依赖   | 基础设施是所有功能的前置条件             |
| US004        | US005-US035（所有）        | 强依赖   | 数据库表结构是所有数据操作的基础         |
| US008        | US018, US021               | 强依赖   | 用户角色分配是权限控制的前提             |
| US010        | US012, US013, US014, US017 | 强依赖   | SQL编辑器是报表设计的起点                |
| US012        | US014, US017, US023        | 强依赖   | 参数配置是动态查询的基础                 |
| US013        | US014, US017, US025        | 强依赖   | 列配置是数据展示的基础                   |
| US034        | US013, US017, US025        | 技术依赖 | 动态列渲染是列配置和表格展示的技术基础   |
| US014        | US015, US016, US017, US018 | 弱依赖   | 需要先能创建报表，才能编辑/删除/授权     |
| US017        | US014                      | 弱依赖   | 报表预览在创建流程中使用，但也可独立测试 |
| US018        | US021                      | 强依赖   | 报表权限分配是用户端查看报表列表的前提   |
| US021        | US022, US023, US024        | 强依赖   | 需要先能查看报表列表，才能选择报表查询   |
| US023        | US024                      | 强依赖   | 参数输入是执行查询的前置步骤             |
| US024        | US025, US026, US027, US028 | 强依赖   | 查询结果是展示和导出的数据源             |
| US029, US030 | US018, US021               | 强依赖   | RBAC权限模型是权限控制的基础             |
| US033        | US017, US024               | 强依赖   | SQL安全校验是SQL执行的前置检查           |

**关键路径（Critical Path）**:

```
US001-US004 (基础设施)
  → US008, US029, US030 (权限基础)
  → US010, US034 (技术基础)
  → US012, US013 (报表配置)
  → US014 (报表创建)
  → US017, US033 (报表测试)
  → US018 (权限分配)
  → US021 (用户端入口)
  → US023, US024 (查询)
  → US025, US028 (展示与导出)
```

**并行开发建议**:

- **第1-2天**: US001-US004（基础设施）串行开发
- **第3-4天**: US005-US008（管理端）与US029-US030（权限）并行开发
- **第5-7天**: US010（SQL编辑器）与US034（动态列渲染）并行开发
- **第8-10天**: US012-US016（报表设计）与US033（SQL安全）并行开发
- **第11-13天**: US021-US024（用户端查询）可与US017-US018（设计端授权）并行开发

---

## ⚠️ 风险提示

### 风险1: Sprint 1工作量超载

**风险描述**: Sprint 1预估21人日，2人并行需要10.5天，超出1周（5天）一倍

**影响**: Sprint 1延期可能导致整个MVP延期

**缓解措施**:

1. ✅ **前置技术预研**: Sprint 0（准备阶段）完成CodeMirror、POI等技术选型和Demo验证
2. ✅ **压缩功能范围**: 将US019、US020移至Sprint 2
3. ✅ **简化实现**: US033（SQL安全校验）MVP仅实现基础白名单+黑名单，深度校验放V2
4. ✅ **加强并行**: US010与US034、US017与US033尽量并行开发
5. ⚠️ **延长Sprint**: 如必要，Sprint 1延长至1.5周（7.5天）

---

### 风险2: 动态列渲染技术复杂度高

**风险描述**: US034（动态列渲染）技术实现复杂，可能影响US013、US017、US025的开发

**影响**: 设计端和用户端的数据展示功能延期

**缓解措施**:

1. ✅ **技术预研**: Sprint 0阶段验证ResultSetMetaData提取列信息的可行性
2. ✅ **前置开发**: US034在Sprint 1第5天开始，确保US013、US017、US025有可用的技术基础
3. ✅ **降级方案**: 如US034开发受阻，US013先实现"手动配置列"，自动提取功能V2再补充
4. ✅ **技术支持**: 必要时外部技术专家Review代码，提供优化建议

---

### 风险3: SQL安全校验覆盖不全

**风险描述**: US033（SQL安全校验）实现不够深度，可能存在SQL注入或恶意查询风险

**影响**: 数据安全事故（数据泄露、数据篡改、系统崩溃）

**缓解措施**:

1. ✅ **分层防御**: 白名单（仅SELECT）+ 黑名单（禁止危险关键字）+ 只读账号 + 超时控制
2. ✅ **PreparedStatement**: 所有参数化查询使用PreparedStatement，防止注入
3. ✅ **人工Review**: 报表创建后由管理员Review SQL语句
4. ✅ **灰度发布**: MVP初期限制报表创建权限（仅管理员可创建），验证安全性后再开放
5. ⚠️ **渗透测试**: V2增加专业安全测试

---

### 风险4: Excel导出大数据量性能问题

**风险描述**: US028（Excel导出）在大数据量（>5000行）时可能内存溢出或导出超时

**影响**: 用户体验差，系统稳定性下降

**缓解措施**:

1. ✅ **限制导出行数**: MVP强制限制5000行，超过提示用户添加筛选条件
2. ✅ **内存管理**: 使用Apache POI的SXSSFWorkbook（流式API）代替XSSFWorkbook
3. ✅ **超时控制**: 导出接口设置超时时间（30秒），避免长时间阻塞
4. ⚠️ **异步导出**: V2实现后台异步生成 + 邮件通知下载

---

### 风险5: 权限控制逻辑复杂度高

**风险描述**: RBAC权限模型涉及多表联查（用户→角色→报表），性能可能成为瓶颈

**影响**: 用户端报表列表加载慢，查询权限校验延迟

**缓解措施**:

1. ✅ **简化模型**: MVP使用三个固定角色（ADMIN、DESIGNER、VIEWER），不支持自定义角色
2. ✅ **索引优化**: user_role表和report_role_permission表添加联合索引
3. ✅ **缓存机制**: US031（权限缓存）实现用户权限数据缓存（TTL=5分钟）
4. ✅ **Session缓存**: 用户角色信息缓存到Session，避免每次请求都查数据库
5. ⚠️ **Redis缓存**: V2使用Redis分布式缓存，提升多实例场景性能

---

### 风险6: 跨端状态同步问题

**风险描述**: 管理端修改用户角色后，用户端权限未实时更新

**影响**: 用户体验不一致，权限控制失效

**缓解措施**:

1. ✅ **Session失效**: 角色变更后清除用户Session，强制重新登录
2. ⚠️ **WebSocket推送**: V2实现实时消息推送，通知用户权限变更
3. ⚠️ **权限缓存TTL**: 将权限缓存TTL缩短至1分钟，加快权限更新

---

### 风险7: 测试覆盖不足

**风险描述**: 2周时间紧张，测试时间预留不足（仅2天），可能遗漏Bug

**影响**: MVP上线后发现严重Bug，影响用户使用

**缓解措施**:

1. ✅ **边开发边测试**: 每个Story完成后立即进行单元测试和功能测试
2. ✅ **自动化测试**: 核心API（查询执行、Excel导出、权限校验）编写自动化测试用例
3. ✅ **回归测试**: Sprint 2前2天进行全量回归测试，确保无破坏性变更
4. ✅ **灰度发布**: MVP先在小范围用户试用，收集反馈后再全量发布
5. ⚠️ **测试环境**: 搭建独立测试环境，避免开发环境干扰

---

## ✅ 优化建议总结

### 立即执行的改进（Sprint Planning前）

1. **US010（SQL编辑器）**: 明确使用CodeMirror 5.65.x，调整工作量至2天
2. **US013（列配置）**: 添加前置依赖说明，调整工作量至2天
3. **US014（报表创建）**: 细化验收标准（SQL校验、异常处理、边界测试）
4. **US017（报表预览）**: 明确技术依赖US033，调整工作量至2.5天
5. **US023（参数输入表单）**: 明确支持的参数类型，调整工作量至2天
6. **US025（数据表格展示）**: 明确依赖US034，调整工作量至2天
7. **US034（动态列渲染）**: 提升为Must Have，前置到Sprint 1第5天开始

### 迭代规划调整

1. **Sprint 1**: 移出US018（为报表分配角色权限），移入US034（动态列渲染）
2. **Sprint 2**: 移入US018（从Sprint 1），确保有充足时间测试权限控制
3. **降级功能**: US019、US020、US031移至Should Have，US035保持Could Have

### 风险控制措施

1. **技术预研**: Sprint 0阶段验证CodeMirror、ResultSetMetaData、Apache POI
2. **前置开发**: US034在Sprint 1第5天开始，确保后续Story有技术基础
3. **并行开发**: US010与US034、US017与US033、US021与US018尽量并行
4. **灰度发布**: MVP初期限制报表创建权限，验证安全性后再开放

---

## 📈 后续行动清单

- [ ] **立即行动**: 召开Sprint Planning会议，评审本评估报告
- [ ] **Day 1**: 根据改进建议修订用户故事（US010、US013、US014、US017、US023、US025、US034）
- [ ] **Day 1**: 调整迭代规划（Sprint 1移出US018，移入US034）
- [ ] **Day 2**: 技术预研（CodeMirror、ResultSetMetaData、Apache POI）
- [ ] **Day 3**: Sprint 0启动，搭建开发环境，完成API设计
- [ ] **Day 4**: Sprint 1启动会，明确任务分工和依赖关系
- [ ] **Week 2**: Sprint 1 Review，确认基础设施和设计端功能完成度
- [ ] **Week 3**: Sprint 2启动会，明确用户端开发任务
- [ ] **Week 4**: Sprint 2 Review + MVP发布准备
- [ ] **Week 4**: 灰度发布，收集用户反馈，规划V2功能

---

**文档状态**: 已完成 ✅
**下一步**:

1. 产品经理和Scrum Master评审本报告
2. 开发团队对改进建议的用户故事进行Story Refinement
3. Sprint Planning会议，确认Sprint 1和Sprint 2的Story列表和工作量
