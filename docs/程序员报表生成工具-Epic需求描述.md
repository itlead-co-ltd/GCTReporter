# 程序员报表生成工具 - Epic需求描述

> **文档类型**: Epic需求描述
> **创建日期**: 2025-12-26
> **来源**: 程序员报表生成工具-MVP项目分析报告

---

## 【Epic名称】

程序员报表生成工具 - MVP版本

---

## 【业务背景】

开发一个面向程序员的报表生成工具，支持三端架构（管理端、设计端、用户端），核心价值是让开发人员能够快速创建、分享和管理SQL查询报表。

这是一个**低代码报表平台**的简化版，类似帆软、润乾等商业报表工具的核心功能子集，聚焦在：

- ✅ 快速查询与展示
- ✅ 基于角色的权限控制（RBAC）
- ✅ Excel导出
- ✅ 三端分离架构（管理端/设计端/用户端）
- ❌ 不包含复杂图表
- ❌ 不包含报表设计器拖拽
- ❌ 不包含组织架构树形权限

**约束条件**:

- **人员约束**: 开发团队2名开发人员（熟悉SpringBoot和Vue框架）
- **技术约束**: 后端SpringBoot、前端Vue.js、数据库MySQL 5.7+、单机部署
- **时间约束**: MVP交付时间2周（10个工作日），总工作量20人日（16人日核心功能 + 4人日Buffer）

---

## 【核心目标】

开发一个面向程序员的报表生成工具，支持三端架构（管理端、设计端、用户端），实现SQL查询管理、报表预览（设计端）、报表查询（用户端）、Excel导出和基于角色的权限控制（RBAC）。

**成功标准**:

- 完成核心功能16人日的开发任务
- 通过所有P0级别功能验收（管理端、设计端、用户端共40项验收点）
- 性能指标：1000行数据查询<3秒，Excel导出<5秒，报表列表加载<1秒
- 无P0级别Bug（数据丢失、系统崩溃、SQL注入）

---

## 【主要功能点】

### 核心功能（MVP必须）

#### 1. SQL查询管理 ⭐ (P0)

**功能描述**:
- 输入SQL查询语句（仅支持SELECT）
- 定义查询参数（参数名、类型、默认值、是否必填）
- 支持参数占位符格式: `#{paramName}`
- 测试执行查询，预览结果

**技术要点**:
- SQL安全校验（防止注入）
- PreparedStatement参数化
- 查询超时控制（5秒）

**所属端**: 设计端
**工作量**: 2人日
**依赖关系**: 无

---

#### 2. 报表模板设计 ⭐ (P0)

**功能描述**:
- 基于查询结果配置列属性
  - 字段名（来自SQL结果集）
  - 显示名称（自定义）
  - 列宽（像素）
  - 数据格式化（日期/数字/货币）
- 报表元信息（名称、描述、创建人）

**技术要点**:
- 动态列提取（从ResultSet元数据）
- 列配置持久化（JSON或关联表）

**所属端**: 设计端
**工作量**: 2人日
**依赖关系**: SQL查询管理

---

#### 3. 报表预览（设计端）⭐ (P0)

**功能描述**:
- **所属端**: 设计端（Designer）
- **使用场景**: 报表设计阶段的测试验证
- 前端表格展示查询结果
- 分页显示（每页100条）
- 按列排序
- 实时参数输入
- 支持多次调试执行，验证SQL正确性

**技术要点**:
- Vue + Element Table组件
- 动态列渲染
- 前端分页
- 设计端独享功能（ADMIN和DESIGNER角色可用）

**所属端**: 设计端
**工作量**: 2人日
**依赖关系**: 报表模板设计

---

#### 4. 报表查询（用户端）⭐ (P0)

**功能描述**:
- **所属端**: 用户端（Viewer）
- **使用场景**: 普通用户查询已授权的报表数据
- 查看授权报表列表
- 选择特定报表进入查询页面
- 输入查询参数
- 执行查询并展示结果
- 分页显示（每页100条）
- 按列排序

**技术要点**:
- 权限过滤：仅显示已授权报表
- 参数表单自动生成（基于报表参数定义）
- 动态列渲染
- 前端分页和排序

**所属端**: 用户端
**工作量**: 2人日
**依赖关系**: 报表模板设计

---

#### 5. Excel导出 ⭐ (P0)

**功能描述**:
- **所属端**: 用户端（Viewer）
- 导出查询结果为Excel文件（.xlsx）
- 文件命名: `报表名_YYYYMMDD.xlsx`
- 包含表头（显示名称）和数据行
- 限制导出行数: **最多5000行**

**技术要点**:
- Apache POI（XSSFWorkbook）
- 超过5000行时提示用户添加筛选条件
- 后端生成文件流，前端下载
- **依赖报表查询功能**，只能导出已查询出的数据

**所属端**: 用户端
**工作量**: 1人日
**依赖关系**: 报表查询

---

#### 6. 基于角色的权限控制（RBAC）⭐ (P0)

**功能描述**:
- **角色定义**: 管理员（ADMIN）、设计者（DESIGNER）、普通用户（VIEWER）
- **角色-报表关联**: 设计端分配报表权限给角色（而非单个用户）
- **用户-角色关联**: 管理端为用户分配角色
- **权限继承**: ADMIN > DESIGNER > VIEWER（管理员可访问所有报表）
- **访问控制**: 拦截器校验用户角色与报表权限

**角色权限矩阵**:

| 角色     | 管理端功能 | 设计端功能        | 用户端功能      |
| -------- | ---------- | ----------------- | --------------- |
| ADMIN    | ✅ 全部    | ✅ 全部（含报表预览）           | ✅ 全部（含报表查询） |
| DESIGNER | ❌ 无      | ✅ 创建/编辑/授权/预览 | ✅ 查看授权报表（报表查询） |
| VIEWER   | ❌ 无      | ❌ 无             | ✅ 查看授权报表（报表查询） |

**技术要点**:
- 简化RBAC模型（三个固定角色，不支持自定义角色）
- 角色-报表多对多关联
- 拦截器校验用户角色权限
- Session或Token认证

**所属端**: 管理端
**工作量**: 2人日
**依赖关系**: 用户管理

---

#### 7. 用户登录/登出 ⭐ (P0)

**所属端**: 全端通用
**工作量**: 1人日
**依赖关系**: 无

---

### 可延期功能（V2版本）

#### 1. 高级分组权限（V2）- P1

**延期理由**: 复杂权限模型开发+测试需要5人日，MVP时间不足

**功能描述**:
- 角色管理（管理员/设计者/普通用户）
- 组织架构树
- 角色继承与权限聚合

**预估工作量**: 8人日

---

#### 2. 报表样式美化（V2）- P2

**延期理由**: MVP重功能轻美观，用户体验优化属于V2

**功能描述**:
- 自定义配色主题
- 企业logo与页眉页脚
- 报表模板市场（预置模板）

**预估工作量**: 5人日

---

#### 3. 复杂参数联动（V2）- P2

**延期理由**: MVP支持基础参数输入即可，联动属于增强体验

**功能描述**:
- 省市区三级联动
- 日期范围校验（开始日期≤结束日期）
- 参数间依赖关系定义

**预估工作量**: 3人日

---

#### 4. 图表支持（V2）- P2

**延期理由**: 数据展示以表格为主，图表属于可视化增强

**功能描述**:
- ECharts集成
- 柱状图、折线图、饼图
- 图表配置（坐标轴、颜色、标题）

**预估工作量**: 5人日

---

#### 5. 定时任务（V2）- P2

**延期理由**: MVP专注手动查询，自动化属于运营需求

**功能描述**:
- 定时执行报表（每天/每周/每月）
- 邮件发送结果
- 执行结果归档

**预估工作量**: 5人日（Quartz + 邮件服务）

---

#### 6. 数据缓存优化（V2）- P2

**延期理由**: MVP限制5000行导出，性能压力可控

**功能描述**:
- Redis缓存查询结果
- 增量刷新
- 缓存失效策略

**预估工作量**: 5人日

---

## 【涉及用户角色】

### 1. 管理员（ADMIN）

**角色描述**: 系统最高权限拥有者，负责用户和角色管理

**核心诉求**:
- 创建和管理用户账号
- 为用户分配角色（ADMIN/DESIGNER/VIEWER）
- 查看系统所有报表（不受权限限制）
- 全局配置和系统监控

**主要功能权限**:
- 管理端：✅ 全部功能
- 设计端：✅ 全部功能（含报表预览）
- 用户端：✅ 全部功能（含报表查询）

**使用频率**: 低（主要在系统初始化和用户变更时使用）

---

### 2. 设计者（DESIGNER）

**角色描述**: 报表设计和开发人员，负责创建和维护报表

**核心诉求**:
- 创建和编辑报表（SQL编写、参数配置、列配置）
- 测试和调试报表（报表预览功能）
- 为报表分配角色权限（决定哪些角色可以查看该报表）
- 管理自己创建的报表

**主要功能权限**:
- 管理端：❌ 无权限
- 设计端：✅ 创建/编辑/授权/预览
- 用户端：✅ 查看授权报表（报表查询）

**使用频率**: 中（主要在报表开发和维护阶段使用）

---

### 3. 普通用户（VIEWER）

**角色描述**: 报表的最终使用者，通过报表查询和分析数据

**核心诉求**:
- 查看已授权的报表列表
- 输入参数并执行报表查询
- 查看查询结果（表格展示、分页、排序）
- 导出Excel文件进行后续分析

**主要功能权限**:
- 管理端：❌ 无权限
- 设计端：❌ 无权限
- 用户端：✅ 查看授权报表（报表查询）

**使用频率**: 高（日常业务数据查询和分析）

---

## 【技术考量】

### 安全性要求

1. **SQL注入防护**:
   - 仅支持SELECT语句
   - SQL关键字黑名单（DROP、DELETE、TRUNCATE、UPDATE、INSERT、ALTER、CREATE、EXEC等）
   - PreparedStatement参数化
   - 查询超时控制（5秒）
   - 使用只读数据库账号

2. **权限控制**:
   - 拦截器校验用户角色与报表权限
   - Session或Token认证
   - 权限缓存（TTL=5分钟）

3. **数据安全**:
   - 密码加密存储（BCrypt）
   - 执行日志记录（审计需求）

### 性能要求

- 1000行数据查询响应时间 < 3秒
- Excel导出（1000行）耗时 < 5秒
- 报表列表加载时间 < 1秒
- 5个用户并发查询无阻塞

### 技术栈

- **后端**: SpringBoot 2.7.x、Spring Data JPA、Druid连接池、Apache POI
- **前端**: Vue.js 2.6.x、Element UI、Vuex、Vue Router、CodeMirror（SQL编辑器）
- **数据库**: MySQL 5.7+
- **部署**: 单机部署（MVP阶段）

---

## 【功能优先级矩阵】

| 功能模块      | 所属端   | 优先级 | MVP | 工作量 | 依赖关系     |
| ------------- | -------- | ------ | --- | ------ | ------------ |
| SQL查询管理   | 设计端   | P0     | ✅  | 2人日  | 无           |
| 报表模板设计  | 设计端   | P0     | ✅  | 2人日  | SQL查询管理  |
| 报表预览      | 设计端   | P0     | ✅  | 2人日  | 报表模板设计 |
| 报表查询      | 用户端   | P0     | ✅  | 2人日  | 报表模板设计 |
| Excel导出     | 用户端   | P0     | ✅  | 1人日  | 报表查询     |
| 基础权限控制  | 管理端   | P0     | ✅  | 2人日  | 用户管理     |
| 用户登录/登出 | 全端通用 | P0     | ✅  | 1人日  | 无           |
| 高级分组权限  | 管理端   | P1     | ❌  | 8人日  | 基础权限     |
| 报表样式美化  | 设计端   | P2     | ❌  | 5人日  | 无           |
| 复杂参数联动  | 用户端   | P2     | ❌  | 3人日  | 报表查询     |
| 图表支持      | 用户端   | P2     | ❌  | 5人日  | 报表查询     |
| 定时任务      | 设计端   | P2     | ❌  | 5人日  | 报表执行     |
| 数据缓存优化  | 全端通用 | P2     | ❌  | 5人日  | 无           |

**MVP总计**: 10人日核心功能 + 6人日基础设施 = **16人日**

---

## 【三端功能分布说明】

### 管理端（Admin）
- 用户管理（创建、编辑、禁用/启用用户）
- 角色分配（为用户分配角色）
- 用户搜索（按用户名或真实姓名）
- 全局浏览（可查看系统所有报表）

### 设计端（Designer）
- SQL编写（SQL编辑器，语法高亮）
- 报表设计（配置报表名称、描述、SQL、参数、列配置）
- 参数配置（添加参数，配置参数名、类型、默认值、是否必填）
- **报表预览**（测试执行SQL，验证配置）
- 角色授权（为报表分配角色权限）
- 权限管理（显示和取消已授权角色）

### 用户端（Viewer）
- 报表列表（查看已授权的报表）
- 报表搜索（按报表名称搜索）
- **报表查询**（选择报表、输入参数、执行查询）
- 数据展示（表格展示、分页、排序）
- Excel导出（导出查询结果）

---

**文档状态**: 已完成 ✅
