# Sprint 3 迭代任务计划

> **Sprint周期**: 第4周（7个工作日）  
> **Sprint目标**: 完成用户端查询和Excel导出，系统功能闭环  
> **团队**: 开发者A（前端）+ 开发者B（后端）  
> **工作量**: 14.5人日

---

## 📊 Sprint 3 Story清单

| Story ID | 故事标题 | 优先级 | 工作量 | 负责人 | 状态 |
|----------|---------|--------|--------|--------|------|
| US021 | 报表列表查询 | P0 | 1天 | A+B | ⚪ 待开始 |
| US022 | 报表参数输入 | P0 | 1天 | A | ⚪ 待开始 |
| US023 | 报表结果展示 | P0 | 1.5天 | A | ⚪ 待开始 |
| US024 | 报表执行历史 | P1 | 1天 | A+B | ⚪ 待开始 |
| US025 | 报表分页 | P1 | 1.5天 | A+B | ⚪ 待开始 |
| US026 | 报表排序 | P2 | 1天 | A+B | ⚪ 待开始 |
| US028 | Excel导出 | P0 | 3天 | A+B | ⚪ 待开始 |
| US029 | 报表列表权限过滤 | P0 | 0.5天 | B | ⚪ 待开始 |
| US030 | 报表查询权限校验 | P0 | 1天 | B | ⚪ 待开始 |
| US031 | 操作审计日志 | P1 | 3天 | A+B | ⚪ 待开始 |

---

## 📋 US021: 报表列表查询

### 故事描述
**作为** 普通用户  
**我想要** 查看我有权访问的报表列表  
**以便** 选择报表进行查询

### 故事验收标准
- [ ] 显示报表名称、描述、创建时间
- [ ] 仅显示当前用户有权限的报表
- [ ] 支持按名称搜索
- [ ] 点击报表进入查询页面
- [ ] 列表分页显示（每页20条）

### 详细任务拆解

#### T021-1: 报表列表页面UI（开发者A，2h）
**描述**: 创建用户端报表列表页面
**验收标准**:
- [ ] 页面布局清晰
- [ ] 表格显示报表信息
- [ ] 搜索框位于表格上方
- [ ] 点击报表名称可跳转
- [ ] 响应式设计

#### T021-2: 报表卡片设计（开发者A，1.5h）
**描述**: 使用Card展示报表
**验收标准**:
- [ ] Card包含报表名称
- [ ] Card包含报表描述
- [ ] Card包含创建时间
- [ ] Card包含查询按钮
- [ ] Card有hover效果

#### T021-3: 搜索功能（开发者A，1h）
**描述**: 实现报表搜索
**验收标准**:
- [ ] 搜索框实时搜索
- [ ] 按名称模糊匹配
- [ ] 防抖处理（300ms）
- [ ] 搜索结果即时更新
- [ ] 空结果提示

#### T021-4: 报表列表API修改（开发者B，2h）
**描述**: 修改GET /api/v1/reports接口
**验收标准**:
- [ ] 根据用户角色过滤报表
- [ ] 支持name参数模糊搜索
- [ ] 支持分页（page、size参数）
- [ ] 返回total总数
- [ ] 按创建时间倒序

#### T021-5: 列表加载优化（开发者A+B，1.5h）
**描述**: 优化列表加载性能
**验收标准**:
- [ ] 首次加载显示骨架屏
- [ ] 加载时间<1秒
- [ ] 滚动加载流畅
- [ ] 无重复请求
- [ ] 测试通过

---

## 📋 US022: 报表参数输入

### 故事描述
**作为** 用户  
**我想要** 在查询报表时输入参数  
**以便** 获取我需要的数据

### 故事验收标准
- [ ] 参数输入表单清晰
- [ ] 必填参数标记*
- [ ] 参数类型匹配（文本/数字/日期）
- [ ] 表单验证生效
- [ ] 保存历史输入值（最近5次）

### 详细任务拆解

#### T022-1: 参数输入表单UI（开发者A，2h）
**描述**: 创建参数输入表单
**验收标准**:
- [ ] 根据参数配置动态生成
- [ ] 必填参数标*
- [ ] 参数说明显示
- [ ] 表单布局清晰
- [ ] 响应式设计

#### T022-2: 参数类型控件（开发者A，2h）
**描述**: 实现不同类型参数控件
**验收标准**:
- [ ] STRING显示Input
- [ ] NUMBER显示InputNumber
- [ ] DATE显示DatePicker
- [ ] DATETIME显示DateTimePicker
- [ ] 控件样式一致

#### T022-3: 参数验证规则（开发者A，1.5h）
**描述**: 实现参数验证
**验收标准**:
- [ ] 必填参数验证
- [ ] NUMBER类型验证
- [ ] DATE格式验证
- [ ] 验证错误提示清晰
- [ ] 验证通过可提交

#### T022-4: 历史参数值保存（开发者A，2h）
**描述**: 保存最近使用的参数值
**验收标准**:
- [ ] 提交成功保存参数值
- [ ] 保存到localStorage
- [ ] 按报表ID分组存储
- [ ] 最多保存5次
- [ ] 下拉选择历史值

#### T022-5: 参数输入测试（开发者A，1.5h）
**描述**: 测试参数输入功能
**验收标准**:
- [ ] 参数动态生成测试通过
- [ ] 类型控件渲染测试通过
- [ ] 参数验证测试通过
- [ ] 历史值保存测试通过
- [ ] E2E测试通过

---

## 📋 US023: 报表结果展示

### 故事描述
**作为** 用户  
**我想要** 查看报表查询结果  
**以便** 获取数据洞察

### 故事验收标准
- [ ] 查询结果表格展示
- [ ] 应用列格式化配置
- [ ] 显示查询执行时间
- [ ] 支持表格横向滚动
- [ ] 空结果友好提示

### 详细任务拆解

#### T023-1: 结果表格组件（开发者A，2h）
**描述**: 创建结果表格组件
**验收标准**:
- [ ] 使用Element Plus Table
- [ ] 动态生成列
- [ ] 支持横向滚动
- [ ] 表格样式符合设计
- [ ] 响应式布局

#### T023-2: 列格式化应用（开发者A，1.5h）
**描述**: 应用列配置
**验收标准**:
- [ ] 读取列配置
- [ ] 应用显示名称
- [ ] 应用列宽
- [ ] 应用格式化类型
- [ ] 隐藏列不显示

#### T023-3: 执行状态显示（开发者A，1h）
**描述**: 显示查询状态和耗时
**验收标准**:
- [ ] 查询中显示Loading
- [ ] 查询成功显示耗时
- [ ] 查询失败显示错误
- [ ] 状态图标显示
- [ ] 状态文字颜色区分

#### T023-4: 空结果处理（开发者A，1h）
**描述**: 处理查询无结果情况
**验收标准**:
- [ ] 显示Empty组件
- [ ] 提示文字友好
- [ ] 显示建议操作
- [ ] 图标提示
- [ ] 样式美观

#### T023-5: 报表查询API（开发者B，3h）
**描述**: 实现POST /api/v1/reports/{id}/execute接口
**验收标准**:
- [ ] 接收参数值
- [ ] 校验用户权限
- [ ] 执行SQL查询
- [ ] 返回结果集
- [ ] 记录执行日志

#### T023-6: 结果展示测试（开发者A+B，2h）
**描述**: 测试结果展示功能
**验收标准**:
- [ ] 表格渲染测试通过
- [ ] 格式化应用测试通过
- [ ] 空结果处理测试通过
- [ ] 错误处理测试通过
- [ ] E2E测试通过

---

## 📋 US024: 报表执行历史

### 故事描述
**作为** 用户  
**我想要** 查看我的报表执行历史  
**以便** 了解历史查询记录

### 故事验收标准
- [ ] 显示执行时间、执行状态、耗时
- [ ] 支持按时间筛选
- [ ] 支持分页展示
- [ ] 点击历史记录重新执行
- [ ] 显示最近30天记录

### 详细任务拆解

#### T024-1: 执行历史列表UI（开发者A，2h）
**描述**: 创建执行历史页面
**验收标准**:
- [ ] 表格显示历史记录
- [ ] 显示执行时间、状态、耗时
- [ ] 时间筛选器
- [ ] 分页组件
- [ ] 重新执行按钮

#### T024-2: 时间筛选器（开发者A，1.5h）
**描述**: 实现时间范围筛选
**验收标准**:
- [ ] DatePicker范围选择
- [ ] 快捷选项（今天、本周、本月）
- [ ] 默认显示最近7天
- [ ] 筛选即时生效
- [ ] 清空筛选功能

#### T024-3: 重新执行功能（开发者A，1h）
**描述**: 点击历史记录重新执行
**验收标准**:
- [ ] 重新执行按钮
- [ ] 加载历史参数值
- [ ] 自动提交查询
- [ ] 查询成功更新结果
- [ ] 查询失败显示错误

#### T024-4: 执行历史API（开发者B，2h）
**描述**: 实现GET /api/v1/reports/{id}/history接口
**验收标准**:
- [ ] 查询execution_logs表
- [ ] 仅返回当前用户记录
- [ ] 支持时间范围筛选
- [ ] 支持分页
- [ ] 按执行时间倒序

#### T024-5: 执行日志记录（开发者B，1.5h）
**描述**: 记录查询执行日志
**验收标准**:
- [ ] 执行成功记录日志
- [ ] 执行失败记录日志
- [ ] 记录参数值（JSON）
- [ ] 记录执行时间
- [ ] 记录成功状态

#### T024-6: 执行历史测试（开发者A，1h）
**描述**: 测试执行历史功能
**验收标准**:
- [ ] 历史列表加载测试通过
- [ ] 时间筛选测试通过
- [ ] 重新执行测试通过
- [ ] 日志记录测试通过
- [ ] E2E测试通过

---

## 📋 US025: 报表分页

### 故事描述
**作为** 用户  
**我想要** 分页查看大数据量报表  
**以便** 快速加载和浏览数据

### 故事验收标准
- [ ] 默认每页20条
- [ ] 可切换每页10/20/50/100条
- [ ] 显示总记录数
- [ ] 显示总页数
- [ ] 分页切换流畅

### 详细任务拆解

#### T025-1: 分页组件集成（开发者A，1.5h）
**描述**: 集成Element Plus Pagination
**验收标准**:
- [ ] 分页组件位于表格下方
- [ ] 显示总记录数
- [ ] 显示当前页码
- [ ] 页码切换正常
- [ ] 样式符合设计

#### T025-2: 每页条数切换（开发者A，1h）
**描述**: 实现每页条数切换
**验收标准**:
- [ ] 下拉框包含10/20/50/100
- [ ] 默认选中20
- [ ] 切换后重新加载
- [ ] 保存用户选择
- [ ] 切换动画平滑

#### T025-3: 分页参数传递（开发者A，1h）
**描述**: 传递分页参数到后端
**验收标准**:
- [ ] page参数（从1开始）
- [ ] size参数
- [ ] URL参数同步
- [ ] 刷新页面保持参数
- [ ] 参数验证

#### T025-4: 后端分页实现（开发者B，3h）
**描述**: 实现SQL分页查询
**验收标准**:
- [ ] 使用LIMIT OFFSET分页
- [ ] 计算total总数（COUNT查询）
- [ ] 返回data数组和total
- [ ] 性能优化（索引）
- [ ] 单元测试覆盖

#### T025-5: 分页性能优化（开发者B，2h）
**描述**: 优化分页查询性能
**验收标准**:
- [ ] COUNT查询优化
- [ ] 避免OFFSET过大性能问题
- [ ] 缓存total（5分钟）
- [ ] 索引优化
- [ ] 性能测试通过（<1秒）

#### T025-6: 分页测试（开发者A+B，1.5h）
**描述**: 测试分页功能
**验收标准**:
- [ ] 分页组件测试通过
- [ ] 每页条数切换测试通过
- [ ] 后端分页测试通过
- [ ] 性能测试通过
- [ ] E2E测试通过

---

## 📋 US026: 报表排序

### 故事描述
**作为** 用户  
**我想要** 对报表结果排序  
**以便** 按需要的顺序查看数据

### 故事验收标准
- [ ] 点击列头排序
- [ ] 支持升序/降序
- [ ] 显示排序图标
- [ ] 仅允许单列排序
- [ ] 排序保持分页

### 详细任务拆解

#### T026-1: 表格排序UI（开发者A，1.5h）
**描述**: 实现表格列排序
**验收标准**:
- [ ] 列头可点击排序
- [ ] 显示排序图标（▲▼）
- [ ] 升序/降序切换
- [ ] 取消排序功能
- [ ] 排序列高亮

#### T026-2: 排序参数传递（开发者A，1h）
**描述**: 传递排序参数到后端
**验收标准**:
- [ ] sortField参数（列名）
- [ ] sortOrder参数（asc/desc）
- [ ] URL参数同步
- [ ] 刷新页面保持排序
- [ ] 参数验证

#### T026-3: 后端排序实现（开发者B，2h）
**描述**: 实现SQL ORDER BY排序
**验收标准**:
- [ ] 动态拼接ORDER BY子句
- [ ] 校验sortField合法性（防注入）
- [ ] 支持ASC/DESC
- [ ] 默认按第一列排序
- [ ] 单元测试覆盖

#### T026-4: 排序安全校验（开发者B，1.5h）
**描述**: 防止排序字段SQL注入
**验收标准**:
- [ ] sortField白名单校验
- [ ] 仅允许列配置中的字段
- [ ] 拒绝特殊字符
- [ ] 日志记录非法排序
- [ ] 返回明确错误

#### T026-5: 排序测试（开发者A+B，1.5h）
**描述**: 测试排序功能
**验收标准**:
- [ ] 前端排序UI测试通过
- [ ] 后端排序实现测试通过
- [ ] 安全校验测试通过
- [ ] 排序+分页联合测试通过
- [ ] E2E测试通过

---

## 📋 US028: Excel导出

### 故事描述
**作为** 用户  
**我想要** 将报表结果导出为Excel  
**以便** 离线分析数据

### 故事验收标准
- [ ] 导出按钮显眼
- [ ] 导出当前查询结果
- [ ] Excel包含列头
- [ ] 应用列格式化
- [ ] 导出进度提示
- [ ] 导出文件命名清晰

### 详细任务拆解

#### T028-1: 导出按钮UI（开发者A，0.5h）
**描述**: 创建导出按钮
**验收标准**:
- [ ] 按钮位于结果表格上方
- [ ] 图标+文字显示
- [ ] 按钮样式符合设计
- [ ] 无查询结果时禁用
- [ ] Tooltip提示

#### T028-2: 导出进度提示（开发者A，1h）
**描述**: 显示导出进度
**验收标准**:
- [ ] 点击后显示Loading
- [ ] 显示"正在导出..."
- [ ] 导出成功显示Toast
- [ ] 导出失败显示错误
- [ ] 进度条（可选）

#### T028-3: 前端导出调用（开发者A，1.5h）
**描述**: 调用导出API
**验收标准**:
- [ ] POST /api/v1/reports/{id}/export
- [ ] 传递参数值和分页信息
- [ ] 接收Blob响应
- [ ] 触发文件下载
- [ ] 文件名格式：报表名称_日期时间.xlsx

#### T028-4: POI Excel生成（开发者B，4h）
**描述**: 使用Apache POI生成Excel
**验收标准**:
- [ ] 创建Workbook和Sheet
- [ ] 写入列头行
- [ ] 写入数据行
- [ ] 应用列宽
- [ ] 应用数字格式
- [ ] 应用日期格式

#### T028-5: 列格式化应用（开发者B，2h）
**描述**: Excel中应用列格式化
**验收标准**:
- [ ] DATE列格式为日期格式
- [ ] NUMBER列格式为数字格式
- [ ] CURRENCY列格式为货币格式
- [ ] 文本列左对齐
- [ ] 数字列右对齐

#### T028-6: 导出API（开发者B，3h）
**描述**: 实现POST /api/v1/reports/{id}/export接口
**验收标准**:
- [ ] 执行查询获取数据
- [ ] 调用POI生成Excel
- [ ] 返回文件流（application/vnd.ms-excel）
- [ ] 设置Content-Disposition响应头
- [ ] 文件名中文编码正确

#### T028-7: 导出限制（开发者B，1.5h）
**描述**: 限制导出数据量
**验收标准**:
- [ ] 最多导出5000行
- [ ] 超过限制显示警告
- [ ] 建议使用分页导出
- [ ] 日志记录导出操作
- [ ] 超时控制30秒

#### T028-8: Excel导出测试（开发者A+B，2.5h）
**描述**: 测试Excel导出功能
**验收标准**:
- [ ] 小数据量导出测试通过（<100行）
- [ ] 大数据量导出测试通过（1000行）
- [ ] 限制测试通过（5000行边界）
- [ ] 格式化测试通过
- [ ] 中文文件名测试通过
- [ ] E2E测试通过

---

## 📋 US029: 报表列表权限过滤

### 故事描述
**作为** 用户  
**我想要** 仅看到我有权访问的报表  
**以便** 避免查看无权限报表

### 故事验收标准
- [ ] 列表仅显示授权报表
- [ ] ADMIN查看所有报表
- [ ] DESIGNER查看自己创建的报表
- [ ] VIEWER查看授权的报表
- [ ] 未授权报表不显示

### 详细任务拆解

#### T029-1: 报表列表权限过滤（开发者B，2h）
**描述**: 修改GET /api/v1/reports接口
**验收标准**:
- [ ] 获取当前用户角色
- [ ] ADMIN返回所有报表
- [ ] DESIGNER返回creator_id=当前用户的报表
- [ ] VIEWER返回有权限的报表
- [ ] SQL使用LEFT JOIN关联权限表

#### T029-2: 权限过滤测试（开发者B，1h）
**描述**: 测试权限过滤
**验收标准**:
- [ ] ADMIN权限测试通过
- [ ] DESIGNER权限测试通过
- [ ] VIEWER权限测试通过
- [ ] 未授权测试通过
- [ ] 单元测试覆盖率>85%

---

## 📋 US030: 报表查询权限校验

### 故事描述
**作为** 系统  
**我想要** 校验用户查询报表的权限  
**以便** 防止未授权访问

### 故事验收标准
- [ ] 查询前校验权限
- [ ] 未授权返回403错误
- [ ] ADMIN绕过权限检查
- [ ] 权限日志记录
- [ ] 错误提示清晰

### 详细任务拆解

#### T030-1: 查询权限校验（开发者B，2h）
**描述**: 在查询API中校验权限
**验收标准**:
- [ ] 获取当前用户角色
- [ ] 查询报表权限配置
- [ ] 角色匹配允许查询
- [ ] 角色不匹配返回403
- [ ] ADMIN绕过检查

#### T030-2: 权限拒绝日志（开发者B，1h）
**描述**: 记录权限拒绝日志
**验收标准**:
- [ ] 记录用户信息
- [ ] 记录报表ID
- [ ] 记录时间戳
- [ ] 日志级别WARN
- [ ] 日志格式统一

#### T030-3: 前端权限错误处理（开发者A，1h）
**描述**: 处理403权限错误
**验收标准**:
- [ ] 捕获403错误
- [ ] 显示权限不足提示
- [ ] 提供联系管理员按钮
- [ ] 跳转到报表列表
- [ ] 错误信息清晰

#### T030-4: 查询权限测试（开发者A+B，2h）
**描述**: 测试查询权限功能
**验收标准**:
- [ ] 有权限用户测试通过
- [ ] 无权限用户测试通过
- [ ] ADMIN绕过测试通过
- [ ] 权限日志测试通过
- [ ] E2E测试通过

---

## 📋 US031: 操作审计日志

### 故事描述
**作为** 系统管理员  
**我想要** 查看系统操作审计日志  
**以便** 追踪用户行为和排查问题

### 故事验收标准
- [ ] 记录用户登录日志
- [ ] 记录报表CRUD操作
- [ ] 记录报表查询日志
- [ ] 记录权限配置变更
- [ ] 日志包含时间、用户、操作、结果

### 详细任务拆解

#### T031-1: audit_logs表设计（开发者B，1h）
**描述**: 创建审计日志表
**验收标准**:
- [ ] id、user_id、operation、resource_type、resource_id字段
- [ ] operation_time、ip_address字段
- [ ] success、error_message字段
- [ ] 索引：user_id、operation_time
- [ ] Flyway迁移脚本

#### T031-2: AuditLogService（开发者B，2h）
**描述**: 创建审计日志服务
**验收标准**:
- [ ] logLogin方法
- [ ] logReportCreate方法
- [ ] logReportUpdate方法
- [ ] logReportDelete方法
- [ ] logReportQuery方法
- [ ] 异步记录日志（不阻塞主流程）

#### T031-3: 审计日志切面（开发者B，3h）
**描述**: 使用AOP拦截操作
**验收标准**:
- [ ] 创建@Audited注解
- [ ] 创建AuditLogAspect切面
- [ ] 拦截Controller方法
- [ ] 提取操作信息
- [ ] 调用AuditLogService

#### T031-4: 审计日志查询页面（开发者A，3h）
**描述**: 创建审计日志查询页面
**验收标准**:
- [ ] 表格显示日志
- [ ] 时间范围筛选
- [ ] 用户筛选
- [ ] 操作类型筛选
- [ ] 分页展示

#### T031-5: 审计日志查询API（开发者B，2h）
**描述**: 实现GET /api/v1/audit-logs接口
**验收标准**:
- [ ] 支持时间范围筛选
- [ ] 支持用户筛选
- [ ] 支持操作类型筛选
- [ ] 支持分页
- [ ] 仅ADMIN可访问

#### T031-6: IP地址记录（开发者B，1.5h）
**描述**: 记录用户IP地址
**验收标准**:
- [ ] 从HttpServletRequest获取IP
- [ ] 处理X-Forwarded-For代理
- [ ] 记录到audit_logs表
- [ ] IPv4/IPv6支持
- [ ] 单元测试覆盖

#### T031-7: 审计日志测试（开发者A+B，2.5h）
**描述**: 测试审计日志功能
**验收标准**:
- [ ] 登录日志记录测试通过
- [ ] CRUD操作日志测试通过
- [ ] 查询日志记录测试通过
- [ ] 日志查询测试通过
- [ ] 权限控制测试通过
- [ ] E2E测试通过

---

## 📊 Sprint 3 进度跟踪

### 每日站会记录

| 日期 | 完成Story | 进行中Story | 阻碍问题 | 解决方案 |
|------|----------|------------|---------|---------|
| Day 1 |  |  |  |  |
| Day 2 |  |  |  |  |
| Day 3 |  |  |  |  |
| Day 4 |  |  |  |  |
| Day 5 |  |  |  |  |
| Day 6 |  |  |  |  |
| Day 7 |  |  |  |  |

### Sprint燃尽图

```
14.5人日 │                            ╲
         │                             ╲
         │                              ╲
         │                               ╲
         │                                ╲
         │                                 ╲
         │                                  ╲
         │                                   ╲
         │                                    ╲
      0  └─────────────────────────────────────╲
         Day1  Day2  Day3  Day4  Day5  Day6  Day7
```

---

## ✅ Sprint 3 完成标准

### Sprint目标达成
- [ ] 用户可以查询报表
- [ ] 用户可以导出Excel
- [ ] 权限控制生效
- [ ] 审计日志记录完整

### 质量标准
- [ ] 单元测试覆盖率 > 80%
- [ ] 所有E2E测试通过
- [ ] 代码审查通过
- [ ] 无P0/P1级别Bug

### 性能标准
- [ ] 报表查询P95 < 3秒
- [ ] Excel导出（1000行）< 5秒
- [ ] 列表加载 < 1秒

### 文档完成
- [ ] 用户手册更新
- [ ] API文档更新
- [ ] 部署文档完成

---

*更新时间: 2026-01-15*  
*负责人: Scrum Master*
